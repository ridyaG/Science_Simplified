<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Science Simplified ‚Äì NEET Practice</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --gold:#C89B14;--gold-l:#E8B91A;--gold-d:#A07A0A;
  --blue:#1A3E8C;--blue-l:#2551B5;--blue-d:#0F2560;
  --bg:#F5F7FA;--dark:#0F1020;
  --tx:#1A1A2E;--txm:#444466;
  --green:#1A6B3C;--green-l:#2E9B5A;
  --red:#C0392B;--amber:#C05020;
  --purple:#5A2D82;--purple-l:#7B3FB0;
  --teal:#0D7377;--teal-l:#14A085;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Nunito',sans-serif;background:var(--bg);min-height:100vh;color:var(--tx);overflow-x:hidden;}
h1,h2,h3,.pp{font-family:'Poppins',sans-serif;}

/* SPLASH */
#splash{position:fixed;inset:0;z-index:1000;background:linear-gradient(160deg,var(--blue-d),var(--blue));display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;overflow:hidden;}
#splash.out{animation:splOut .4s ease forwards;}@keyframes splOut{to{opacity:0;pointer-events:none;}}
.sp-atom{position:relative;width:140px;height:140px;display:flex;align-items:center;justify-content:center;opacity:0;animation:aIn .6s .1s ease forwards;}@keyframes aIn{from{opacity:0;transform:scale(.3)}to{opacity:1;transform:scale(1)}}
.nucleus{width:32px;height:32px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#FFD700,var(--gold));box-shadow:0 0 24px 8px rgba(200,155,20,.7);position:absolute;z-index:2;animation:nGlow 1.5s 2s ease-in-out infinite alternate;}@keyframes nGlow{from{box-shadow:0 0 24px 8px rgba(200,155,20,.7)}to{box-shadow:0 0 48px 16px rgba(200,155,20,1)}}
.orbit{position:absolute;border-radius:50%;border:2.5px solid rgba(200,155,20,0);animation:oDraw .6s ease forwards;}.o1{width:110px;height:42px;transform:rotate(0deg);animation-delay:.5s}.o2{width:110px;height:42px;transform:rotate(60deg);animation-delay:.7s}.o3{width:110px;height:42px;transform:rotate(120deg);animation-delay:.9s}@keyframes oDraw{from{border-color:rgba(200,155,20,0)}to{border-color:rgba(200,155,20,.85)}}
.electron{position:absolute;width:8px;height:8px;border-radius:50%;background:var(--gold-l);box-shadow:0 0 8px 3px var(--gold);}.o1 .electron{animation:sp1 2.4s 1.1s linear infinite}.o2 .electron{animation:sp1 2.1s 1.3s linear infinite reverse}.o3 .electron{animation:sp1 1.9s 1.5s linear infinite}@keyframes sp1{from{transform:translate(51px,-4px) rotate(0deg) translateX(-51px)}to{transform:translate(51px,-4px) rotate(360deg) translateX(-51px)}}
.bz{position:absolute;opacity:0;}.bz-l{left:-60px;animation:bzL .5s .9s ease forwards}.bz-r{right:-60px;animation:bzR .5s 1.1s ease forwards}@keyframes bzL{from{opacity:0;transform:translateX(-40px)}to{opacity:.5;transform:translateX(0)}}@keyframes bzR{from{opacity:0;transform:translateX(40px)}to{opacity:.5;transform:translateX(0)}}
.sp-title{opacity:0;text-align:center;animation:tUp .5s 1.5s ease forwards;font-family:'Poppins',sans-serif;font-weight:800;font-size:1.55rem;color:#fff;letter-spacing:.08em;}.sp-inst{font-size:.7rem;letter-spacing:.22em;color:var(--gold-l);font-weight:600;margin-top:2px;display:block;}@keyframes tUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.sp-tag{opacity:0;animation:tUp .5s 2.1s ease forwards;color:rgba(255,255,255,.7);font-size:.95rem;font-style:italic;}.td{color:var(--gold);font-style:normal;}

/* APP */
#app{display:none;min-height:100vh;flex-direction:column;}#app.vis{display:flex;animation:appIn .4s ease;}@keyframes appIn{from{opacity:0}to{opacity:1}}

/* HEADER */
.hdr{background:#fff;border-bottom:2px solid rgba(200,155,20,.13);padding:12px 20px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 12px rgba(26,62,140,.07);position:sticky;top:0;z-index:100;}
.logo-ic{width:38px;height:38px;background:linear-gradient(135deg,var(--blue-d),var(--blue));border-radius:10px;display:flex;align-items:center;justify-content:center;}
.logo-tx{font-family:'Poppins',sans-serif;font-weight:700;font-size:.8rem;color:var(--blue);line-height:1.2;}.logo-tx span{color:var(--gold);display:block;font-size:.65rem;font-weight:600;}
.hdr-r{margin-left:auto;display:flex;align-items:center;gap:8px;}
.greet{font-size:.82rem;color:var(--txm);font-weight:600;}
.ubtn{background:linear-gradient(135deg,var(--blue-d),var(--blue));color:#fff;border:none;padding:6px 14px;border-radius:8px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.75rem;cursor:pointer;transition:all .15s;}.ubtn:hover{transform:scale(1.04);}

/* SCREENS */
.scr{display:none;flex-direction:column;flex:1;}.scr.on{display:flex;}

/* HOME */
.hero{padding:28px 20px 12px;text-align:center;}.hero h1{font-size:clamp(1.2rem,5vw,1.8rem);color:var(--blue);line-height:1.3;margin-bottom:8px;}.hero p{color:var(--txm);font-size:.9rem;}
.cgrid{padding:12px 16px 8px;display:flex;flex-direction:column;gap:12px;}@media(min-width:560px){.cgrid{flex-direction:row;flex-wrap:wrap;justify-content:center;}.hcard{flex:1;min-width:140px;max-width:190px;}}
.hcard{border-radius:18px;padding:20px 16px;cursor:pointer;color:#fff;box-shadow:0 6px 28px rgba(0,0,0,.18);transition:transform .18s,box-shadow .18s;position:relative;overflow:hidden;display:flex;flex-direction:column;gap:7px;}.hcard:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 12px 40px rgba(0,0,0,.22);}.hcard:active{transform:scale(.97);}.hcard::before{content:'';position:absolute;inset:0;background:rgba(255,255,255,.05);border-radius:inherit;}
.c-phy{background:linear-gradient(135deg,#1A3E8C,#2551B5);}.c-bio{background:linear-gradient(135deg,#1A6B3C,#2E9B5A);}.c-che{background:linear-gradient(135deg,#7A2A0A,#C05020);}.c-pyq{background:linear-gradient(135deg,#0D7377,#14A085);}.c-lb{background:linear-gradient(135deg,#5A2D82,#8B5CF6);}.c-ana{background:linear-gradient(135deg,#0F2560,#1A3E8C);}
.hc-ico{font-size:2rem;line-height:1;}.hc-nm{font-family:'Poppins',sans-serif;font-weight:700;font-size:1.1rem;}.hc-mt{font-size:.78rem;opacity:.85;}

/* TOPICS */
.t-hdr{background:linear-gradient(135deg,var(--blue-d),var(--blue));padding:14px 16px;display:flex;align-items:center;gap:12px;color:#fff;}
.t-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:1.1rem;flex:1;}
.bk{background:rgba(255,255,255,.15);border:none;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;font-family:'Nunito',sans-serif;font-weight:600;font-size:.9rem;transition:background .15s;white-space:nowrap;}.bk:hover{background:rgba(255,255,255,.25);}
.tab-bar{display:flex;background:#fff;border-bottom:2px solid rgba(26,62,140,.1);}
.tab{flex:1;padding:11px;border:none;background:none;font-family:'Poppins',sans-serif;font-weight:600;font-size:.9rem;color:var(--txm);cursor:pointer;border-bottom:3px solid transparent;transition:all .18s;}.tab.on{color:var(--blue);border-bottom-color:var(--gold);background:rgba(200,155,20,.05);}
.ch-list{flex:1;overflow-y:auto;padding:12px 14px;display:flex;flex-direction:column;gap:10px;}
.ch-card{background:#fff;border-radius:14px;padding:14px 16px;box-shadow:0 2px 10px rgba(26,62,140,.07);display:flex;align-items:center;gap:12px;border-left:5px solid var(--blue);transition:box-shadow .15s,transform .15s;}.ch-card:hover{box-shadow:0 5px 20px rgba(26,62,140,.13);transform:translateX(2px);}
.ch-num{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--blue-d),var(--blue));color:#fff;font-family:'Poppins',sans-serif;font-weight:700;font-size:.85rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.ch-info{flex:1;min-width:0;}.ch-nm{font-family:'Poppins',sans-serif;font-weight:600;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.ch-sub{font-size:.75rem;color:var(--txm);margin-top:2px;}
.pb{height:5px;background:#eee;border-radius:99px;margin-top:6px;}.pb-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold-l));transition:width .3s;}
.go-btn{background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#fff;border:none;padding:8px 16px;border-radius:10px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.85rem;cursor:pointer;white-space:nowrap;box-shadow:0 3px 12px rgba(200,155,20,.35);transition:all .15s;}.go-btn:hover{transform:scale(1.05);}

/* LEVEL MODAL */
.ovl{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.6);display:flex;align-items:flex-end;justify-content:center;}
.sheet{background:#fff;border-radius:24px 24px 0 0;padding:24px 20px 32px;width:100%;max-width:480px;animation:shUp .3s ease;}@keyframes shUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sh-title{font-family:'Poppins',sans-serif;font-weight:800;font-size:1.1rem;color:var(--blue);text-align:center;margin-bottom:4px;}
.sh-sub{text-align:center;font-size:.83rem;color:var(--txm);margin-bottom:18px;}
.lv-cards{display:flex;flex-direction:column;gap:11px;}
.lvc{border-radius:14px;padding:15px 17px;cursor:pointer;border:2.5px solid transparent;display:flex;align-items:center;gap:14px;transition:all .18s;}.lvc:hover{transform:translateX(4px);}
.lv-bas{background:rgba(46,155,90,.06);border-color:rgba(46,155,90,.2);}.lv-bas:hover{border-color:var(--green-l);}
.lv-int{background:rgba(200,155,20,.06);border-color:rgba(200,155,20,.2);}.lv-int:hover{border-color:var(--gold);}
.lv-adv{background:rgba(192,57,43,.06);border-color:rgba(192,57,43,.2);}.lv-adv:hover{border-color:var(--red);}
.lv-ic{font-size:1.9rem;flex-shrink:0;}.lv-nm{font-family:'Poppins',sans-serif;font-weight:700;font-size:.97rem;}.lv-bas .lv-nm{color:var(--green);}.lv-int .lv-nm{color:var(--gold-d);}.lv-adv .lv-nm{color:var(--red);}.lv-ds{font-size:.78rem;color:var(--txm);margin-top:2px;}
.sh-cancel{width:100%;margin-top:13px;padding:12px;border:none;background:#f5f5f5;border-radius:12px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.9rem;color:var(--txm);cursor:pointer;}

/* LOADING */
.load-scr{background:var(--dark);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;flex:1;}
.spin{width:56px;height:56px;border-radius:50%;border:4px solid rgba(200,155,20,.15);border-top-color:var(--gold);animation:spin .9s linear infinite;}@keyframes spin{to{transform:rotate(360deg)}}
.load-badge{padding:5px 16px;border-radius:99px;background:rgba(200,155,20,.15);border:1px solid rgba(200,155,20,.3);color:var(--gold);font-family:'Poppins',sans-serif;font-weight:700;font-size:.8rem;}
.load-tx{font-family:'Poppins',sans-serif;font-weight:600;color:rgba(255,255,255,.8);font-size:1rem;text-align:center;}
.load-sub{font-size:.78rem;color:rgba(255,255,255,.35);margin-top:-12px;text-align:center;}

/* QUIZ */
.q-scr{background:var(--dark);}
.qtop{background:#16192E;padding:12px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(200,155,20,.15);}
.qtitle{flex:1;text-align:center;font-family:'Poppins',sans-serif;font-weight:600;color:#fff;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sc-pill{background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#fff;padding:5px 14px;border-radius:99px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.9rem;white-space:nowrap;box-shadow:0 2px 10px rgba(200,155,20,.4);}
.sc-pill.pop{animation:sPop .35s ease;}@keyframes sPop{0%{transform:scale(1)}40%{transform:scale(1.25)}70%{transform:scale(.95)}100%{transform:scale(1)}}
.sc-pill.shk{animation:sShk .4s ease;}@keyframes sShk{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.lv-pill{padding:3px 10px;border-radius:99px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.72rem;}.pl-bas{background:rgba(46,155,90,.2);color:#6EE7B7;}.pl-int{background:rgba(200,155,20,.2);color:var(--gold);}.pl-adv{background:rgba(192,57,43,.2);color:#ff6b6b;}.pl-pyq{background:rgba(13,115,119,.3);color:#5EEAD4;}
.qprog-wrap{background:#16192E;padding:8px 16px 12px;}
.qprog-bar{height:6px;background:rgba(255,255,255,.1);border-radius:99px;overflow:hidden;}.qprog-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),#FFD700);transition:width .4s ease;}.qprog-fill.tl{background:linear-gradient(90deg,var(--teal),var(--teal-l));}
.qctr{font-size:.78rem;color:rgba(255,255,255,.5);margin-top:5px;text-align:right;}
.qcontent{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:14px;}
.qcard{background:#1E2240;border-radius:18px;padding:20px 18px;box-shadow:0 4px 24px rgba(0,0,0,.4);border:1px solid rgba(200,155,20,.12);animation:qIn .3s ease;}.qcard.pyq{border-color:rgba(13,115,119,.25);}@keyframes qIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.qnum{font-size:.75rem;color:var(--gold);font-weight:700;letter-spacing:.08em;margin-bottom:10px;}.qnum.tl{color:#5EEAD4;}
.qtag{display:inline-block;background:rgba(13,115,119,.2);color:#5EEAD4;border-radius:6px;padding:2px 8px;font-size:.68rem;font-weight:700;margin-left:8px;vertical-align:middle;}
.qtext{color:#fff;font-size:1rem;line-height:1.65;}
.opts{display:flex;flex-direction:column;gap:10px;}
.opt{background:#1E2240;border:2px solid rgba(255,255,255,.1);border-radius:13px;padding:13px 16px;display:flex;align-items:flex-start;gap:12px;cursor:pointer;text-align:left;transition:border-color .15s,background .15s,transform .1s;animation:oIn .25s ease backwards;width:100%;}
.opt:nth-child(1){animation-delay:.05s}.opt:nth-child(2){animation-delay:.1s}.opt:nth-child(3){animation-delay:.15s}.opt:nth-child(4){animation-delay:.2s}@keyframes oIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.opt:hover:not(:disabled){border-color:var(--gold);background:rgba(200,155,20,.07);transform:translateX(3px);}.opt:disabled{cursor:default;}
.ol{width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,.08);color:var(--gold);font-family:'Poppins',sans-serif;font-weight:700;font-size:.82rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.ot{color:rgba(255,255,255,.9);font-size:.93rem;line-height:1.5;padding-top:4px;}
.opt.cor{border-color:var(--green-l);background:rgba(46,155,90,.15);}.opt.cor .ol{background:var(--green-l);color:#fff;}
.opt.wrg{border-color:var(--red);background:rgba(192,57,43,.15);}.opt.wrg .ol{background:var(--red);color:#fff;}
.opt.rev{border-color:var(--green-l);background:rgba(46,155,90,.08);opacity:.7;}.opt.rev .ol{background:var(--green-l);color:#fff;}
.skip-btn{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.55);padding:10px;border-radius:12px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.85rem;cursor:pointer;width:100%;transition:all .15s;}.skip-btn:hover{background:rgba(255,255,255,.12);}

/* FEEDBACK + EXPLANATION */
.fb{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px;border-radius:10px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.88rem;animation:fbIn .25s ease;}@keyframes fbIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.fb.cor{background:rgba(46,155,90,.2);color:var(--green-l);}.fb.wrg{background:rgba(192,57,43,.2);color:#ff6b6b;}.fb.skp{background:rgba(255,255,255,.07);color:rgba(255,255,255,.5);}
.expl-box{background:#1E2240;border-radius:14px;padding:14px 16px;border-left:3px solid var(--gold);animation:fbIn .3s ease;}.expl-box.tl{border-left-color:var(--teal);}
.expl-lbl{font-size:.7rem;font-weight:700;color:var(--gold);margin-bottom:8px;letter-spacing:.05em;text-transform:uppercase;}.expl-lbl.tl{color:#5EEAD4;}
.expl-tx{color:rgba(255,255,255,.85);font-size:.88rem;line-height:1.6;}
.steps{margin-top:10px;display:flex;flex-direction:column;gap:7px;}.step-row{display:flex;gap:10px;align-items:flex-start;}
.step-n{width:22px;height:22px;border-radius:50%;background:var(--gold-d);color:#fff;font-size:.7rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;}.step-n.tl{background:var(--teal);}
.step-t{color:rgba(255,255,255,.82);font-size:.84rem;line-height:1.55;}

/* AUTO-ADVANCE */
.aa-wrap{display:flex;flex-direction:column;gap:6px;}
.aa-bar{height:5px;background:rgba(255,255,255,.08);border-radius:99px;overflow:hidden;}.aa-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--teal),var(--teal-l));transition:width .1s linear;}
.aa-lbl{font-size:.72rem;color:rgba(255,255,255,.38);text-align:center;}
.next-btn{background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#fff;border:none;padding:14px;border-radius:14px;font-family:'Poppins',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 4px 20px rgba(200,155,20,.4);transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px;width:100%;animation:nxtIn .3s ease;}@keyframes nxtIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.next-btn:hover{transform:translateY(-2px);}

/* PYQ SELECTOR */
.pyq-hdr{background:linear-gradient(135deg,var(--teal),var(--teal-l));padding:14px 16px;display:flex;align-items:center;gap:12px;color:#fff;}
.pyq-body{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:16px;}
.sec-lbl{font-family:'Poppins',sans-serif;font-weight:700;font-size:.78rem;color:var(--txm);text-transform:uppercase;letter-spacing:.08em;}
.yr-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.yr-btn{background:#fff;border:2.5px solid #e0e0e0;border-radius:14px;padding:14px 8px;text-align:center;cursor:pointer;transition:all .18s;font-family:'Poppins',sans-serif;}.yr-btn:hover{border-color:var(--teal);transform:translateY(-2px);box-shadow:0 4px 14px rgba(13,115,119,.15);}.yr-btn.sel{border-color:var(--teal);background:rgba(13,115,119,.06);}
.yr-num{font-weight:800;font-size:1.2rem;color:var(--teal);}.yr-sub{font-size:.7rem;color:var(--txm);margin-top:2px;}.yr-badge{display:inline-block;background:var(--gold);color:#fff;font-size:.6rem;font-weight:700;padding:1px 6px;border-radius:99px;margin-bottom:4px;}
.sf-row{display:flex;gap:8px;flex-wrap:wrap;}
.sf-btn{flex:1;min-width:70px;padding:9px 6px;border-radius:11px;border:2px solid #e0e0e0;background:#fff;font-family:'Poppins',sans-serif;font-weight:700;font-size:.78rem;cursor:pointer;text-align:center;transition:all .18s;color:var(--txm);}
.sf-all{border-color:var(--teal);background:rgba(13,115,119,.06);color:var(--teal);}.sf-phy{border-color:var(--blue);background:rgba(26,62,140,.06);color:var(--blue);}.sf-bio{border-color:var(--green);background:rgba(26,107,60,.06);color:var(--green);}.sf-che{border-color:var(--amber);background:rgba(192,80,32,.06);color:var(--amber);}
.info-box{background:#fff;border-radius:14px;padding:14px 16px;box-shadow:0 2px 10px rgba(13,115,119,.08);border-left:4px solid var(--teal);}
.info-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:.88rem;color:var(--teal);margin-bottom:8px;}
.info-list{list-style:none;display:flex;flex-direction:column;gap:5px;}.info-list li{font-size:.82rem;color:var(--txm);display:flex;gap:6px;}.info-list li::before{content:'‚Ä∫';color:var(--teal);font-weight:700;flex-shrink:0;}
.pyq-go{background:linear-gradient(135deg,var(--teal),var(--teal-l));color:#fff;border:none;padding:16px;border-radius:16px;font-family:'Poppins',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 4px 20px rgba(13,115,119,.4);transition:all .18s;display:flex;align-items:center;justify-content:center;gap:8px;}.pyq-go:hover{transform:translateY(-2px);}.pyq-go:disabled{opacity:.5;cursor:not-allowed;transform:none;}

/* PYQ TOPBAR */
.pyq-top{background:#081515;padding:12px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(13,115,119,.25);}
.timer{background:rgba(13,115,119,.2);border:1.5px solid rgba(13,115,119,.4);color:#5EEAD4;padding:5px 12px;border-radius:99px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.85rem;white-space:nowrap;}
.timer.warn{background:rgba(200,155,20,.2);border-color:rgba(200,155,20,.4);color:var(--gold);}.timer.dng{background:rgba(192,57,43,.2);border-color:rgba(192,57,43,.4);color:#ff6b6b;animation:pls 1s ease infinite;}@keyframes pls{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
.pyq-ctr-row{display:flex;justify-content:space-between;margin-top:5px;}
.sub-tag{font-size:.7rem;font-weight:700;padding:2px 8px;border-radius:99px;}.st-phy{background:rgba(37,81,181,.3);color:#93C5FD;}.st-bio{background:rgba(46,155,90,.3);color:#6EE7B7;}.st-che{background:rgba(192,80,32,.3);color:#FCA5A5;}

/* RESULTS */
.res-scr{background:linear-gradient(160deg,var(--blue-d) 0%,var(--dark) 100%);}
.res-body{flex:1;overflow-y:auto;padding:20px 16px;display:flex;flex-direction:column;gap:18px;align-items:center;}
.ring-wrap{width:160px;height:160px;border-radius:50%;border:8px solid rgba(200,155,20,.2);display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;box-shadow:0 0 40px rgba(200,155,20,.3);animation:rIn .5s ease;}@keyframes rIn{from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}
.ring-svg{position:absolute;inset:-8px;}.sc-big{font-family:'Poppins',sans-serif;font-weight:900;font-size:2.8rem;color:var(--gold);line-height:1;}.sc-lbl{font-size:.78rem;color:rgba(255,255,255,.6);font-weight:600;}
.perf{padding:8px 24px;border-radius:99px;font-family:'Poppins',sans-serif;font-weight:700;font-size:1rem;animation:bIn .4s .3s ease backwards;box-shadow:0 4px 20px rgba(0,0,0,.3);}@keyframes bIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.p-exc{background:linear-gradient(135deg,#1A6B3C,#2E9B5A);color:#fff;}.p-gd{background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#fff;}.p-pr{background:linear-gradient(135deg,var(--blue-d),var(--blue));color:#fff;}
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;width:100%;animation:stIn .4s .5s ease backwards;}@keyframes stIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.sbox{background:rgba(255,255,255,.07);border-radius:14px;padding:14px;text-align:center;border:1px solid rgba(255,255,255,.08);}.sval{font-family:'Poppins',sans-serif;font-weight:800;font-size:1.6rem;color:#fff;}.slbl{font-size:.75rem;color:rgba(255,255,255,.55);margin-top:2px;}
.sbox.g .sval{color:var(--green-l);}.sbox.r .sval{color:#ff6b6b;}.sbox.gd .sval{color:var(--gold);}
.neet-box{background:linear-gradient(135deg,rgba(200,155,20,.2),rgba(200,155,20,.08));border:2px solid rgba(200,155,20,.35);border-radius:16px;padding:16px;width:100%;text-align:center;animation:stIn .4s .7s ease backwards;}
.neet-lbl{color:rgba(255,255,255,.7);font-size:.8rem;margin-bottom:5px;}.neet-val{font-family:'Poppins',sans-serif;font-weight:900;font-size:2.2rem;color:var(--gold);}.neet-max{font-size:.8rem;color:rgba(255,255,255,.5);}
.save-st{font-size:.78rem;color:rgba(255,255,255,.5);text-align:center;animation:stIn .4s .9s ease backwards;}
.r-btns{display:flex;flex-direction:column;gap:10px;width:100%;animation:stIn .4s 1.1s ease backwards;}
.rbtn{padding:14px;border-radius:14px;border:none;font-family:'Poppins',sans-serif;font-weight:700;font-size:.95rem;cursor:pointer;transition:all .15s;}.rb-p{background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#fff;box-shadow:0 4px 20px rgba(200,155,20,.4);}.rb-s{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.15);}.rbtn:hover{transform:translateY(-2px);}

/* REVIEW */
.rev-hdr{background:linear-gradient(135deg,var(--blue-d),var(--blue));padding:14px 16px;display:flex;align-items:center;gap:12px;color:#fff;}
.rev-list{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:14px;}
.rcard{background:#fff;border-radius:16px;padding:16px;box-shadow:0 2px 12px rgba(26,62,140,.1);}.rcard.c{border-left:5px solid var(--green-l);}.rcard.w{border-left:5px solid var(--red);}.rcard.s{border-left:5px solid #aaa;}
.rc-hdr{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;gap:8px;}
.rc-qn{font-family:'Poppins',sans-serif;font-weight:700;font-size:.8rem;color:var(--blue);}
.rc-bdg{padding:2px 10px;border-radius:99px;font-size:.72rem;font-weight:700;}.rc-bdg.c{background:rgba(46,155,90,.15);color:var(--green);}.rc-bdg.w{background:rgba(192,57,43,.12);color:var(--red);}.rc-bdg.s{background:rgba(0,0,0,.06);color:#666;}
.rc-q{font-size:.9rem;color:var(--tx);line-height:1.6;margin-bottom:12px;}
.rc-opts{display:flex;flex-direction:column;gap:6px;margin-bottom:10px;}.rco{padding:8px 12px;border-radius:9px;font-size:.85rem;display:flex;gap:8px;border:1.5px solid #eee;color:var(--tx);}.rco b{flex-shrink:0;}.rco.ic{background:rgba(46,155,90,.1);border-color:var(--green-l);color:var(--green);}.rco.iw{background:rgba(192,57,43,.1);border-color:var(--red);color:var(--red);}
.rc-expl{background:rgba(26,62,140,.05);border-radius:9px;padding:10px 12px;font-size:.82rem;color:var(--txm);border-left:3px solid var(--gold);line-height:1.55;}
.rc-el{font-weight:700;color:var(--blue);font-size:.78rem;display:block;margin-bottom:4px;}
.rc-steps{margin-top:8px;display:flex;flex-direction:column;gap:5px;}.rc-step{display:flex;gap:7px;font-size:.8rem;color:var(--txm);}.rc-sn{width:18px;height:18px;border-radius:50%;background:var(--blue);color:#fff;font-weight:700;font-size:.65rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.pyq-tag{display:inline-block;background:rgba(13,115,119,.1);color:var(--teal);border-radius:5px;padding:1px 7px;font-size:.68rem;font-weight:700;margin-bottom:6px;}

/* LEADERBOARD */
.lb-hdr{background:linear-gradient(135deg,var(--purple),var(--purple-l));padding:14px 16px;display:flex;align-items:center;gap:12px;color:#fff;}
.lb-body{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px;}
.lbcard{background:#fff;border-radius:14px;padding:13px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 10px rgba(90,45,130,.08);transition:transform .15s;}.lbcard:hover{transform:translateX(2px);}
.lbrnk{width:36px;height:36px;border-radius:10px;font-family:'Poppins',sans-serif;font-weight:800;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}.rk1{background:linear-gradient(135deg,#C89B14,#FFD700);color:#fff;}.rk2{background:linear-gradient(135deg,#888,#aaa);color:#fff;}.rk3{background:linear-gradient(135deg,#C05020,#E07840);color:#fff;}.rkn{background:#f0f0f0;color:var(--txm);}
.lb-info{flex:1;}.lb-nm{font-family:'Poppins',sans-serif;font-weight:700;font-size:.9rem;color:var(--tx);}.lb-meta{font-size:.75rem;color:var(--txm);margin-top:2px;}.lb-sc{font-family:'Poppins',sans-serif;font-weight:800;font-size:1.1rem;color:var(--purple);}
.you-tag{font-size:.65rem;font-weight:700;background:rgba(90,45,130,.12);color:var(--purple);padding:2px 7px;border-radius:99px;margin-left:6px;}

/* ANALYTICS */
.ana-hdr{background:linear-gradient(135deg,var(--blue-d),var(--blue));padding:14px 16px;display:flex;align-items:center;gap:12px;color:#fff;}
.ana-body{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:14px;}
.acard{background:#fff;border-radius:16px;padding:16px;box-shadow:0 2px 12px rgba(26,62,140,.08);}.atitle{font-family:'Poppins',sans-serif;font-weight:700;font-size:.85rem;color:var(--txm);text-transform:uppercase;letter-spacing:.06em;margin-bottom:12px;}
.agrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}.astat{background:var(--bg);border-radius:12px;padding:12px;text-align:center;}.aval{font-family:'Poppins',sans-serif;font-weight:800;font-size:1.5rem;color:var(--blue);}.albl{font-size:.73rem;color:var(--txm);margin-top:2px;}
.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}.bar-lbl{font-size:.82rem;font-weight:600;width:75px;flex-shrink:0;}.bar-wrap{flex:1;height:10px;background:#eee;border-radius:99px;overflow:hidden;}.bar-fill{height:100%;border-radius:99px;transition:width .8s ease;}.bar-pct{font-size:.78rem;font-weight:700;color:var(--txm);width:35px;text-align:right;}
.hist-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f0f0f0;}.hist-item:last-child{border-bottom:none;}
.hist-ico{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;}.hist-info{flex:1;}.hist-nm{font-family:'Poppins',sans-serif;font-weight:600;font-size:.85rem;}.hist-meta{font-size:.72rem;color:var(--txm);margin-top:2px;}.hist-sc{font-family:'Poppins',sans-serif;font-weight:800;font-size:1rem;}

/* USER MODAL */
.ui{width:100%;padding:13px 16px;border:2px solid rgba(26,62,140,.15);border-radius:12px;font-family:'Nunito',sans-serif;font-size:1rem;color:var(--tx);outline:none;transition:border-color .15s;margin-bottom:12px;}.ui:focus{border-color:var(--blue);}
.usave{width:100%;padding:14px;background:linear-gradient(135deg,var(--blue-d),var(--blue));color:#fff;border:none;border-radius:12px;font-family:'Poppins',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;}

/* DIALOG */
.dlg-ovl{position:fixed;inset:0;z-index:400;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;}
.dlg{background:#fff;border-radius:20px;padding:24px 22px;width:min(340px,90vw);box-shadow:0 12px 48px rgba(0,0,0,.3);animation:dlgIn .25s ease;}@keyframes dlgIn{from{opacity:0;transform:scale(.85)}to{opacity:1;transform:scale(1)}}
.dlg-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:1.1rem;margin-bottom:8px;}.dlg-body{font-size:.9rem;color:var(--txm);margin-bottom:20px;line-height:1.5;}.dlg-acts{display:flex;gap:10px;}
.dbtn{flex:1;padding:11px;border-radius:11px;border:none;font-family:'Poppins',sans-serif;font-weight:700;font-size:.9rem;cursor:pointer;transition:all .15s;}.dc{background:#f0f0f0;color:var(--tx);}.dd{background:var(--red);color:#fff;}.dbtn:hover{transform:scale(1.03);}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:#1E2240;color:#fff;padding:10px 20px;border-radius:12px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.85rem;z-index:500;transition:transform .3s ease;white-space:nowrap;box-shadow:0 4px 24px rgba(0,0,0,.4);}.toast.on{transform:translateX(-50%) translateY(0);}.toast.ok{border-left:4px solid var(--green-l);}.toast.err{border-left:4px solid var(--red);}

/* UTILS */
.hide{display:none!important;}
.empty{text-align:center;padding:40px 20px;color:var(--txm);}.eico{font-size:3rem;margin-bottom:12px;}.etitle{font-family:'Poppins',sans-serif;font-weight:600;font-size:1rem;color:var(--tx);margin-bottom:6px;}.esub{font-size:.85rem;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:rgba(200,155,20,.3);border-radius:99px;}

/* QUESTION PALETTE */
.pal-overlay{position:fixed;inset:0;z-index:400;background:rgba(0,0,0,.55);display:none;animation:pal-bg .2s ease;}
.pal-overlay.on{display:block;}
@keyframes pal-bg{from{opacity:0}to{opacity:1}}
.pal-sheet{position:fixed;bottom:0;left:0;right:0;z-index:401;background:#1a1d35;border-radius:22px 22px 0 0;padding:20px 16px 32px;max-height:72vh;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .3s cubic-bezier(.32,1.2,.36,1);}
.pal-sheet.on{transform:translateY(0);}
.pal-drag{width:40px;height:4px;background:rgba(255,255,255,.2);border-radius:99px;margin:0 auto 16px;}
.pal-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.pal-title{font-family:'Poppins',sans-serif;font-weight:700;color:#fff;font-size:1rem;}
.pal-close{background:rgba(255,255,255,.1);border:none;color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;}
.pal-legend{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:14px;}
.pal-leg{display:flex;align-items:center;gap:5px;font-size:.72rem;color:rgba(255,255,255,.6);}
.pal-leg-dot{width:12px;height:12px;border-radius:3px;flex-shrink:0;}
.ld-unans{background:rgba(255,255,255,.15);}
.ld-cor{background:#2E9B5A;}
.ld-wrg{background:#C0392B;}
.ld-skp{background:#E8881A;}
.ld-cur{background:#3B82F6;}
.pal-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px;overflow-y:auto;flex:1;}
@media(min-width:400px){.pal-grid{grid-template-columns:repeat(10,1fr);}}
.pbub{width:100%;aspect-ratio:1;border-radius:8px;border:none;font-family:'Poppins',sans-serif;font-weight:700;font-size:.75rem;cursor:pointer;transition:transform .12s,box-shadow .12s;color:#fff;}
.pbub:hover{transform:scale(1.15);box-shadow:0 4px 14px rgba(0,0,0,.4);}
.pbub.pb-unans{background:rgba(255,255,255,.12);color:rgba(255,255,255,.6);}
.pbub.pb-cor{background:#2E9B5A;}
.pbub.pb-wrg{background:#C0392B;}
.pbub.pb-skp{background:#E8881A;}
.pbub.pb-cur{background:#3B82F6;box-shadow:0 0 0 2px rgba(59,130,246,.6);}
.pal-btn{background:rgba(255,255,255,.08);border:1.5px solid rgba(255,255,255,.2);color:rgba(255,255,255,.85);padding:6px 12px;border-radius:10px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.78rem;cursor:pointer;transition:all .15s;white-space:nowrap;}
.pal-btn:hover{background:rgba(255,255,255,.16);color:#fff;}

.submit-btn{background:linear-gradient(135deg,#1A6B3C,#2E9B5A);color:#fff;border:none;padding:16px;border-radius:16px;font-family:'Poppins',sans-serif;font-weight:700;font-size:1.05rem;cursor:pointer;width:100%;box-shadow:0 6px 24px rgba(46,155,90,.45);transition:all .18s;display:flex;align-items:center;justify-content:center;gap:10px;animation:nxtIn .3s ease;}.submit-btn:hover{transform:translateY(-3px);box-shadow:0 10px 32px rgba(46,155,90,.55);}
.prev-btn{background:rgba(255,255,255,.07);border:1.5px solid rgba(255,255,255,.18);color:rgba(255,255,255,.7);padding:10px 16px;border-radius:12px;font-family:'Poppins',sans-serif;font-weight:600;font-size:.85rem;cursor:pointer;width:100%;transition:all .15s;display:flex;align-items:center;gap:6px;justify-content:center;}.prev-btn:hover{background:rgba(255,255,255,.14);color:#fff;border-color:rgba(255,255,255,.35);transform:translateX(-3px);}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div style="position:relative;display:flex;align-items:center;justify-content:center;">
    <svg class="bz bz-l" width="70" height="80" viewBox="0 0 70 80" fill="none">
      <polygon points="35,5 65,22.5 65,57.5 35,75 5,57.5 5,22.5" stroke="rgba(200,155,20,.6)" stroke-width="2.5" fill="none"/>
      <line x1="35" y1="15" x2="35" y2="65" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
      <line x1="15" y1="27" x2="55" y2="53" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
      <line x1="55" y1="27" x2="15" y2="53" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
    </svg>
    <div class="sp-atom">
      <div class="nucleus"></div>
      <div class="orbit o1"><div class="electron"></div></div>
      <div class="orbit o2"><div class="electron"></div></div>
      <div class="orbit o3"><div class="electron"></div></div>
    </div>
    <svg class="bz bz-r" width="70" height="80" viewBox="0 0 70 80" fill="none">
      <polygon points="35,5 65,22.5 65,57.5 35,75 5,57.5 5,22.5" stroke="rgba(200,155,20,.6)" stroke-width="2.5" fill="none"/>
      <line x1="35" y1="15" x2="35" y2="65" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
      <line x1="15" y1="27" x2="55" y2="53" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
      <line x1="55" y1="27" x2="15" y2="53" stroke="rgba(200,155,20,.3)" stroke-width="1.5" stroke-dasharray="5,5"/>
    </svg>
  </div>
  <div class="sp-title">SCIENCE SIMPLIFIED<span class="sp-inst">INSTITUTE</span></div>
  <div class="sp-tag">Simplify<span class="td">.</span> Practice<span class="td">.</span> Excel<span class="td">.</span></div>
</div>

<!-- APP -->
<div id="app">

  <!-- HEADER -->
  <div class="hdr">
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="logo-ic">
        <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
          <circle cx="11" cy="11" r="4" fill="#C89B14"/>
          <ellipse cx="11" cy="11" rx="10" ry="4" stroke="#C89B14" stroke-width="1.5" fill="none"/>
          <ellipse cx="11" cy="11" rx="10" ry="4" stroke="#C89B14" stroke-width="1.5" fill="none" transform="rotate(60 11 11)"/>
          <ellipse cx="11" cy="11" rx="10" ry="4" stroke="#C89B14" stroke-width="1.5" fill="none" transform="rotate(120 11 11)"/>
        </svg>
      </div>
      <div class="logo-tx">Science Simplified<span>Institute</span></div>
    </div>
    <div class="hdr-r">
      <div class="greet" id="greeting">Good Morning! üëã</div>
      <button class="ubtn" id="user-btn" onclick="openUserModal()">üë§ Set Name</button>
    </div>
  </div>

  <!-- HOME -->
  <div class="scr on" id="scr-home">
    <div class="hero">
      <h1>What do you want to<br>practice today?</h1>
      <p>NEET MCQ ¬∑ Chapter-wise ¬∑ PYQs ¬∑ Auto-advance ¬∑ Supabase powered</p>
    </div>
    <div class="cgrid">
      <div class="hcard c-phy" onclick="openSubject('physics')"><div class="hc-ico">‚öõÔ∏è</div><div class="hc-nm pp">Physics</div><div class="hc-mt">22 chapters ¬∑ 3 levels</div></div>
      <div class="hcard c-bio" onclick="openSubject('biology')"><div class="hc-ico">üß¨</div><div class="hc-nm pp">Biology</div><div class="hc-mt">38 chapters ¬∑ 3 levels</div></div>
      <div class="hcard c-che" onclick="openSubject('chemistry')"><div class="hc-ico">üß™</div><div class="hc-nm pp">Chemistry</div><div class="hc-mt">28 chapters ¬∑ 3 levels</div></div>
      <div class="hcard c-pyq" onclick="openPYQ()"><div class="hc-ico">üìú</div><div class="hc-nm pp">NEET PYQs</div><div class="hc-mt">2019‚Äì2023 ¬∑ Attempt mode</div></div>
      <div class="hcard c-lb" onclick="openLeaderboard()"><div class="hc-ico">üèÜ</div><div class="hc-nm pp">Leaderboard</div><div class="hc-mt">Live rankings</div></div>
      <div class="hcard c-ana" onclick="openAnalytics()"><div class="hc-ico">üìä</div><div class="hc-nm pp">My Progress</div><div class="hc-mt">History ¬∑ Analytics</div></div>
    </div>
    <div style="padding:0 16px 24px;text-align:center;color:var(--txm);font-size:.78rem;opacity:.7;">NEET: +4 correct ¬∑ ‚àí1 wrong ¬∑ Auto-advance 5s ¬∑ Saved to Supabase</div>
  </div>

  <!-- TOPICS -->
  <div class="scr" id="scr-topics">
    <div class="t-hdr">
      <button class="bk" onclick="goHome()">‚Üê Back</button>
      <div class="t-title" id="t-subj-name">Physics</div>
      <span id="t-icon" style="font-size:1.5rem;">‚öõÔ∏è</span>
    </div>
    <div class="tab-bar">
      <button class="tab on" id="tab-11" onclick="switchTab(11)">Class 11</button>
      <button class="tab" id="tab-12" onclick="switchTab(12)">Class 12</button>
    </div>
    <div class="ch-list" id="ch-list"></div>
  </div>

  <!-- LOADING -->
  <div class="scr" id="scr-loading">
    <div class="load-scr">
      <div class="load-badge">üóÑÔ∏è Supabase</div>
      <div class="spin"></div>
      <div class="load-tx" id="load-tx">Fetching questions‚Ä¶</div>
      <div class="load-sub" id="load-sub">Loading from database</div>
    </div>
  </div>

  <!-- CHAPTER QUIZ -->
  <div class="scr q-scr" id="scr-quiz">
    <div class="qtop">
      <button class="bk" onclick="exitQuiz('ch')" style="background:rgba(255,255,255,.1);">‚úï Exit</button>
      <div class="qtitle" id="q-title">Chapter</div>
      <div class="lv-pill pl-bas" id="lv-pill">Basic</div>
      <button class="pal-btn" onclick="openPalette('ch')">üìã</button>
      <div class="sc-pill" id="sc-pill">Score: 0</div>
    </div>
    <div class="qprog-wrap">
      <div class="qprog-bar"><div class="qprog-fill" id="q-prog" style="width:0%"></div></div>
      <div class="qctr" id="q-ctr">Q 1 / 10</div>
    </div>
    <div class="qcontent" id="q-content"></div>
  </div>

  <!-- PYQ SELECTOR -->
  <div class="scr" id="scr-pyq">
    <div class="pyq-hdr">
      <button class="bk" onclick="goHome()">‚Üê Back</button>
      <div class="t-title">üìú NEET PYQ ‚Äî Attempt Mode</div>
    </div>
    <div class="pyq-body">
      <div class="sec-lbl">Select Year</div>
      <div class="yr-grid">
        <div class="yr-btn" id="yr-2025" onclick="selectYear(2025)">
          <div class="yr-badge">Live ‚úÖ</div>
          <div class="yr-num">2025</div>
          <div class="yr-sub">üß¨ Biology ¬∑ 90 Qs</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2024" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2024</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2023" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2023</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2022" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2022</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2021" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2021</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2020" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2020</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
        <div class="yr-btn yr-soon" id="yr-2019" style="opacity:.45;cursor:not-allowed;">
          <div class="yr-num" style="color:#aaa;">2019</div>
          <div class="yr-sub" style="color:#bbb;">Coming soon</div>
        </div>
      </div>
      <div class="info-box">
        <div class="info-title">üìã How Attempt Mode Works</div>
        <ul class="info-list">
          <li>Select a year above, then tap <strong>Start Attempt</strong></li>
          <li>NEET 2025 Biology ‚Äî 90 real questions with step-by-step solutions</li>
          <li>Countdown timer scales to number of questions (2 min / question)</li>
          <li>Tap an option to lock your answer ‚Äî skip anytime (no penalty)</li>
          <li>Solution revealed instantly; auto-advances to next Q after 5 s</li>
          <li>NEET marking: +4 correct ¬∑ ‚àí1 wrong ¬∑ 0 skipped</li>
          <li>Score saved to Supabase leaderboard after every attempt</li>
        </ul>
      </div>
      <button class="pyq-go" id="pyq-go" onclick="startPYQ()" disabled>üìú Start Attempt ‚Üí</button>
    </div>
  </div>

  <!-- PYQ QUIZ -->
  <div class="scr q-scr" id="scr-pyq-quiz">
    <div class="pyq-top">
      <button class="bk" onclick="exitQuiz('pyq')" style="background:rgba(255,255,255,.1);">‚úï Exit</button>
      <div class="qtitle" id="pyq-title">NEET 2023</div>
      <div class="timer" id="pyq-timer">45:00</div>
      <button class="pal-btn" onclick="openPalette('pyq')">üìã</button>
      <div class="sc-pill" id="pyq-sc">0</div>
    </div>
    <div style="background:#081515;padding:8px 16px 12px;">
      <div class="qprog-bar"><div class="qprog-fill tl" id="pyq-prog" style="width:0%"></div></div>
      <div class="pyq-ctr-row">
        <div class="qctr" id="pyq-ctr">Q 1 / 20</div>
        <div class="sub-tag st-bio" id="pyq-sub-tag">üß¨ Biology</div>
      </div>
    </div>
    <div class="qcontent" id="pyq-content" style="background:var(--dark);"></div>
  </div>

  <!-- RESULTS (shared) -->
  <div class="scr res-scr" id="scr-results">
    <div class="qtop" style="background:#16192E;">
      <div style="flex:1;text-align:center;font-family:'Poppins',sans-serif;font-weight:700;color:#fff;font-size:1rem;" id="res-title">Quiz Complete! üéâ</div>
    </div>
    <div class="res-body">
      <div class="ring-wrap">
        <svg class="ring-svg" viewBox="0 0 176 176" fill="none">
          <circle cx="88" cy="88" r="80" stroke="rgba(200,155,20,.15)" stroke-width="8"/>
          <circle cx="88" cy="88" r="80" stroke="url(#rg)" stroke-width="8" stroke-dasharray="502" id="score-arc" stroke-dashoffset="502" stroke-linecap="round" transform="rotate(-90 88 88)" style="transition:stroke-dashoffset 1.2s ease"/>
          <defs><linearGradient id="rg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#C89B14"/><stop offset="100%" stop-color="#FFD700"/></linearGradient></defs>
        </svg>
        <div class="sc-big" id="sc-display">0</div>
        <div class="sc-lbl">NEET Score</div>
      </div>
      <div class="perf" id="perf">üèÜ Excellent!</div>
      <div class="stats-grid">
        <div class="sbox g"><div class="sval" id="r-cor">0</div><div class="slbl">‚úÖ Correct</div></div>
        <div class="sbox r"><div class="sval" id="r-wrg">0</div><div class="slbl">‚ùå Wrong</div></div>
        <div class="sbox"><div class="sval" id="r-skp">0</div><div class="slbl">‚è≠Ô∏è Skipped</div></div>
        <div class="sbox gd"><div class="sval" id="r-tot">0</div><div class="slbl">üìã Total</div></div>
      </div>
      <div class="neet-box">
        <div class="neet-lbl">NEET Score (+4 / ‚àí1)</div>
        <div class="neet-val" id="r-neet">0</div>
        <div class="neet-max" id="r-max">/ 0 maximum</div>
      </div>
      <div class="save-st" id="save-st">üíæ Saving‚Ä¶</div>
      <div class="r-btns" id="r-btns"></div>
    </div>
  </div>

  <!-- REVIEW -->
  <div class="scr" id="scr-review">
    <div class="rev-hdr">
      <button class="bk" onclick="showScr('results')">‚Üê Back</button>
      <div style="flex:1;text-align:center;font-family:'Poppins',sans-serif;font-weight:700;font-size:1rem;">Step-by-Step Review</div>
    </div>
    <div class="rev-list" id="rev-list"></div>
  </div>

  <!-- LEADERBOARD -->
  <div class="scr" id="scr-lb">
    <div class="lb-hdr">
      <button class="bk" onclick="goHome()">‚Üê Back</button>
      <div class="t-title">üèÜ Leaderboard</div>
      <button onclick="loadLB()" style="background:rgba(255,255,255,.15);border:none;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:.8rem;font-weight:600;white-space:nowrap;">‚Üª Refresh</button>
    </div>
    <div class="lb-body" id="lb-body"></div>
  </div>

  <!-- ANALYTICS -->
  <div class="scr" id="scr-ana">
    <div class="ana-hdr">
      <button class="bk" onclick="goHome()">‚Üê Back</button>
      <div class="t-title">üìä My Progress</div>
    </div>
    <div class="ana-body" id="ana-body"></div>
  </div>

</div><!-- /app -->

<!-- LEVEL MODAL -->
<div class="ovl hide" id="lv-modal" onclick="if(event.target===this)closeLvModal()">
  <div class="sheet">
    <div class="sh-title">Choose Difficulty</div>
    <div class="sh-sub" id="lv-modal-sub">Chapter ¬∑ Subject</div>
    <div class="lv-cards">
      <div class="lvc lv-bas" onclick="startQuiz('basic')">
        <div class="lv-ic">üü¢</div>
        <div><div class="lv-nm">Basic</div><div class="lv-ds">Direct recall, NCERT definitions, fundamentals</div></div>
      </div>
      <div class="lvc lv-int" onclick="startQuiz('intermediate')">
        <div class="lv-ic">üü°</div>
        <div><div class="lv-nm">Intermediate</div><div class="lv-ds">Application-based, moderate numericals</div></div>
      </div>
      <div class="lvc lv-adv" onclick="startQuiz('advanced')">
        <div class="lv-ic">üî¥</div>
        <div><div class="lv-nm">Advanced</div><div class="lv-ds">NEET-level tricky, multi-concept problems</div></div>
      </div>
    </div>
    <button class="sh-cancel" onclick="closeLvModal()">Cancel</button>
  </div>
</div>

<!-- USER MODAL -->
<div class="ovl hide" id="user-modal" onclick="if(event.target===this)closeUserModal()">
  <div class="sheet">
    <div class="sh-title">Your Profile</div>
    <div class="sh-sub">Set your name for the leaderboard</div>
    <input class="ui" id="uname-input" type="text" placeholder="Enter your name‚Ä¶" maxlength="30"/>
    <button class="usave" onclick="saveUsername()">Save &amp; Continue</button>
  </div>
</div>

<!-- EXIT DIALOG -->
<div class="dlg-ovl hide" id="exit-dlg">
  <div class="dlg">
    <div class="dlg-title">Exit Quiz?</div>
    <div class="dlg-body">Your current session progress will be lost.</div>
    <div class="dlg-acts">
      <button class="dbtn dc" onclick="closeDlg()">Cancel</button>
      <button class="dbtn dd" onclick="confirmExit()">Exit</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUPABASE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SB_URL='https://lfgtrbwlhnfwpunoixxi.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxmZ3RyYndsaG5md3B1bm9peHhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MDY2MTIsImV4cCI6MjA4Njk4MjYxMn0.U11nGQcc6lDazLUkL2DrO9yKUm5XJq9UOrko40MfLik';
const SBH={'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'return=representation'};
async function sbGet(t,q=''){const r=await fetch(`${SB_URL}/rest/v1/${t}${q}`,{headers:SBH});if(!r.ok)throw new Error(await r.text());return r.json();}
async function sbPost(t,b){const r=await fetch(`${SB_URL}/rest/v1/${t}`,{method:'POST',headers:SBH,body:JSON.stringify(b)});if(!r.ok)throw new Error(await r.text());return r.json();}
async function sbPatch(t,q,b){const r=await fetch(`${SB_URL}/rest/v1/${t}${q}`,{method:'PATCH',headers:SBH,body:JSON.stringify(b)});if(!r.ok)throw new Error(await r.text());return r.json();}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHAPTER DATA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const DATA={
  physics:{icon:'‚öõÔ∏è',chapters:{
    11:[
      {n:'Physical World and Measurement',qs:18},{n:'Kinematics',qs:45},{n:'Laws of Motion',qs:38},
      {n:'Work, Energy and Power',qs:42},{n:'Motion of System of Particles',qs:28},{n:'Gravitation',qs:35},
      {n:'Properties of Bulk Matter',qs:30},{n:'Thermodynamics',qs:40},{n:'Behaviour of Perfect Gas',qs:25},
      {n:'Oscillations and Waves',qs:48}
    ],
    12:[
      {n:'Electrostatics',qs:55},{n:'Current Electricity',qs:50},{n:'Magnetic Effects of Current',qs:45},
      {n:'Magnetism and Matter',qs:30},{n:'Electromagnetic Induction',qs:38},{n:'Alternating Current',qs:35},
      {n:'Electromagnetic Waves',qs:22},{n:'Ray Optics',qs:52},{n:'Wave Optics',qs:32},
      {n:'Dual Nature of Matter',qs:28},{n:'Atoms and Nuclei',qs:40},{n:'Electronic Devices',qs:35}
    ]
  }},
  biology:{icon:'üß¨',chapters:{
    11:[
      {n:'The Living World',qs:22},{n:'Biological Classification',qs:40},{n:'Plant Kingdom',qs:35},
      {n:'Animal Kingdom',qs:45},{n:'Morphology of Flowering Plants',qs:38},{n:'Anatomy of Flowering Plants',qs:30},
      {n:'Structural Organisation in Animals',qs:28},{n:'Cell: The Unit of Life',qs:42},{n:'Biomolecules',qs:48},
      {n:'Cell Cycle and Cell Division',qs:35},{n:'Transport in Plants',qs:25},{n:'Mineral Nutrition',qs:28},
      {n:'Photosynthesis in Higher Plants',qs:50},{n:'Respiration in Plants',qs:35},{n:'Plant Growth and Development',qs:30},
      {n:'Digestion and Absorption',qs:38},{n:'Breathing and Exchange of Gases',qs:32},{n:'Body Fluids and Circulation',qs:40},
      {n:'Excretory Products and Elimination',qs:38},{n:'Locomotion and Movement',qs:35},
      {n:'Neural Control and Coordination',qs:45},{n:'Chemical Coordination',qs:40}
    ],
    12:[
      {n:'Reproduction in Organisms',qs:25},{n:'Sexual Reproduction in Flowering Plants',qs:45},{n:'Human Reproduction',qs:40},
      {n:'Reproductive Health',qs:28},{n:'Principles of Inheritance',qs:55},{n:'Molecular Basis of Inheritance',qs:60},
      {n:'Evolution',qs:42},{n:'Human Health and Disease',qs:50},{n:'Strategies for Enhancement in Food Production',qs:30},
      {n:'Microbes in Human Welfare',qs:35},{n:'Biotechnology: Principles and Processes',qs:45},
      {n:'Biotechnology and its Applications',qs:40},{n:'Organisms and Populations',qs:35},{n:'Ecosystem',qs:38},
      {n:'Biodiversity and Conservation',qs:30},{n:'Environmental Issues',qs:25}
    ]
  }},
  chemistry:{icon:'üß™',chapters:{
    11:[
      {n:'Some Basic Concepts of Chemistry',qs:35},{n:'Structure of Atom',qs:42},{n:'Classification of Elements',qs:38},
      {n:'Chemical Bonding and Molecular Structure',qs:55},{n:'States of Matter',qs:30},{n:'Thermodynamics',qs:40},
      {n:'Equilibrium',qs:50},{n:'Redox Reactions',qs:28},{n:'Hydrogen',qs:20},{n:'s-Block Elements',qs:32},
      {n:'p-Block Elements (Group 13 & 14)',qs:38},{n:'Organic Chemistry ‚Äì Basic Principles',qs:45},
      {n:'Hydrocarbons',qs:42},{n:'Environmental Chemistry',qs:18}
    ],
    12:[
      {n:'The Solid State',qs:35},{n:'Solutions',qs:40},{n:'Electrochemistry',qs:45},{n:'Chemical Kinetics',qs:38},
      {n:'Surface Chemistry',qs:28},{n:'d and f Block Elements',qs:42},{n:'Coordination Compounds',qs:50},
      {n:'Haloalkanes and Haloarenes',qs:38},{n:'Alcohols, Phenols and Ethers',qs:42},
      {n:'Aldehydes, Ketones and Carboxylic Acids',qs:50},{n:'Amines',qs:35},{n:'Biomolecules',qs:30},
      {n:'Polymers',qs:25},{n:'Chemistry in Everyday Life',qs:22}
    ]
  }}
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FALLBACK QUESTIONS (shown when DB is empty)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const FB={
  physics:[
    {q:"Newton's first law gives the concept of:",opts:["Energy","Work","Inertia","Momentum"],ans:2,
     expl:"Newton's first law states a body remains at rest or in motion unless acted on by an external force. This resistance to change is called inertia.",
     steps:["Recall Newton's 1st law: no net force ‚Üí no change in state","The resistance to changing state is the key property","That property is called Inertia ‚Üí Answer: C"]},
    {q:"Escape velocity from Earth's surface ‚âà",opts:["7.9 km/s","11.2 km/s","6.4 km/s","9.8 km/s"],ans:1,
     expl:"v_esc = ‚àö(2gR) = ‚àö(2 √ó 9.8 √ó 6.4√ó10‚Å∂) ‚âà 11,200 m/s = 11.2 km/s.",
     steps:["Formula: v = ‚àö(2gR)","Substitute g=9.8, R=6.4√ó10‚Å∂ m","v = ‚àö(125,440,000) ‚âà 11,200 m/s = 11.2 km/s"]},
    {q:"SI unit of electric flux is:",opts:["N/C","N¬∑m¬≤/C","C/m¬≤","V/m"],ans:1,
     expl:"Œ¶ = E ¬∑ A ¬∑ cosŒ∏. Unit of E = N/C, unit of A = m¬≤. So unit of Œ¶ = N¬∑m¬≤/C.",
     steps:["Write formula: Œ¶ = E √ó A √ó cosŒ∏","Unit of E = N/C, Unit of A = m¬≤","Multiply: N/C √ó m¬≤ = N¬∑m¬≤/C ‚Üí Answer: B"]},
    {q:"Ohm's law V = IR is valid for:",opts:["Semiconductors","Metallic conductors at constant T","All materials","Electrolytes only"],ans:1,
     expl:"Ohm's law holds only for metallic conductors where resistance is constant with temperature.",
     steps:["Ohm's law assumes R = constant","Metals at constant temperature have constant R","Semiconductors are non-ohmic ‚Üí Answer: B"]},
    {q:"After 90 min (half-life = 30 min) fraction remaining:",opts:["1/2","1/4","1/8","1/16"],ans:2,
     expl:"Number of half-lives = 90/30 = 3. Fraction = (1/2)¬≥ = 1/8.",
     steps:["n = total time / half-life = 90/30 = 3 half-lives","Formula: N/N‚ÇÄ = (1/2)^n = (1/2)¬≥","= 1/8 ‚Üí Answer: C"]},
    {q:"Young's double slit: slit separation doubled ‚Üí fringe width:",opts:["Same","Halved","Doubled","4√ó"],ans:1,
     expl:"Fringe width Œ≤ = ŒªD/d. If d doubles, Œ≤ = ŒªD/2d ‚Äî it halves.",
     steps:["Œ≤ = ŒªD/d","If d ‚Üí 2d: Œ≤_new = ŒªD/(2d) = Œ≤/2","Fringe width becomes half ‚Üí Answer: B"]},
    {q:"Energy stored in capacitor charged to V:",opts:["CV","¬ΩCV¬≤","CV¬≤","2CV¬≤"],ans:1,
     expl:"Work done to charge capacitor from 0 to Q: U = Q¬≤/2C = ¬ΩCV¬≤.",
     steps:["dW = V¬∑dq = (q/C)dq","Integrate 0‚ÜíQ: W = Q¬≤/2C","Since Q=CV: U = ¬ΩCV¬≤ ‚Üí Answer: B"]},
    {q:"Uniform circular motion ‚Äî what remains constant?",opts:["Velocity","Acceleration","Speed","Displacement"],ans:2,
     expl:"Speed (magnitude) stays constant; direction changes continuously, so velocity and acceleration vectors keep changing.",
     steps:["Uniform circular motion = constant magnitude of velocity","Magnitude of velocity = speed","Direction changes ‚Üí velocity not constant; speed = constant ‚Üí Answer: C"]}
  ],
  biology:[
    {q:"Glucose breakdown without oxygen is called:",opts:["Aerobic respiration","Fermentation","Photosynthesis","Transpiration"],ans:1,
     expl:"Fermentation is anaerobic breakdown of glucose producing ethanol/lactic acid + CO‚ÇÇ, without using O‚ÇÇ.",
     steps:["No oxygen available ‚Üí anaerobic pathway","Glycolysis occurs ‚Üí pyruvate","Pyruvate ‚Üí ethanol + CO‚ÇÇ or lactic acid = fermentation ‚Üí Answer: B"]},
    {q:"'Powerhouse of the cell' is:",opts:["Ribosome","Lysosome","Mitochondria","Golgi apparatus"],ans:2,
     expl:"Mitochondria produce ATP via oxidative phosphorylation (Krebs cycle + ETC), earning them the 'powerhouse' title.",
     steps:["ATP is the cell's energy currency","Mitochondria carry out Krebs cycle + oxidative phosphorylation","Maximum ATP produced here ‚Üí powerhouse ‚Üí Answer: C"]},
    {q:"DNA replication is semiconservative because:",opts:["Only one strand made","Each daughter DNA = one old + one new strand","Both strands are new","DNA replicates twice"],ans:1,
     expl:"Meselson-Stahl experiment (1958) proved that each daughter molecule retains one parental strand and one newly synthesised strand.",
     steps:["Meselson & Stahl used ¬π‚ÅµN/¬π‚Å¥N labelling","After 1 replication: hybrid DNA found","Proves each daughter has 1 old + 1 new strand = semiconservative ‚Üí Answer: B"]},
    {q:"Universal donor blood group:",opts:["A","B","AB","O"],ans:3,
     expl:"Group O lacks A and B antigens on RBCs, so it doesn't trigger immune reaction in recipients of other groups.",
     steps:["O group: no A or B antigens on RBCs","No antigens = no antibody reaction in recipient","Can donate to all groups ‚Üí universal donor ‚Üí Answer: D"]},
    {q:"Functional unit of kidney:",opts:["Nephron","Neuron","Villus","Glomerulus"],ans:0,
     expl:"The nephron is the structural and functional unit of the kidney, performing filtration, reabsorption, and secretion.",
     steps:["Each kidney has ~1 million nephrons","Nephron = glomerulus + Bowman's capsule + tubules + collecting duct","All urine-forming steps occur within one nephron ‚Üí Answer: A"]},
    {q:"Fight-or-flight hormone:",opts:["Insulin","Thyroxine","Adrenaline","Glucagon"],ans:2,
     expl:"Adrenaline (epinephrine) from the adrenal medulla prepares the body for fight-or-flight by raising heart rate, BP, and blood glucose.",
     steps:["Stress ‚Üí hypothalamus ‚Üí sympathetic nervous system","Adrenal medulla secretes adrenaline (epinephrine)","Increases heart rate, dilates pupils, raises blood glucose ‚Üí Answer: C"]},
    {q:"Light reactions of photosynthesis occur in:",opts:["Stroma","Grana (thylakoid membranes)","Cytosol","Nucleus"],ans:1,
     expl:"Thylakoid membranes (grana) contain photosystems I and II where light is absorbed and ATP + NADPH are produced.",
     steps:["Chloroplast has two regions: grana (thylakoids) and stroma","Photosystems are embedded in thylakoid membranes","Light-dependent reactions ‚Üí ATP + NADPH produced in grana ‚Üí Answer: B"]},
    {q:"Law of Segregation proposed by:",opts:["Darwin","Lamarck","Mendel","Morgan"],ans:2,
     expl:"Gregor Mendel proposed the Law of Segregation: alleles separate during gamete formation, each gamete gets one allele.",
     steps:["Mendel crossed Pisum sativum (pea plants) in mono-hybrid crosses","Observed 3:1 ratio in F2 generation","Proposed alleles segregate during gamete formation ‚Üí Answer: C"]}
  ],
  chemistry:[
    {q:"Hybridisation of carbon in CH‚ÇÑ:",opts:["sp","sp¬≤","sp¬≥","sp¬≥d"],ans:2,
     expl:"Carbon in CH‚ÇÑ forms 4 equivalent œÉ bonds requiring sp¬≥ hybridisation ‚Üí tetrahedral geometry, bond angle 109.5¬∞.",
     steps:["Carbon: 4 valence electrons, needs 4 bonds","Mix 1s + 3p orbitals ‚Üí 4 sp¬≥ hybrid orbitals","4 equivalent bonds, tetrahedral shape, 109.5¬∞ ‚Üí Answer: C"]},
    {q:"Highest electronegativity element:",opts:["Oxygen","Nitrogen","Fluorine","Chlorine"],ans:2,
     expl:"Fluorine has the highest electronegativity (3.98 Pauling) because of its small atomic size and high effective nuclear charge.",
     steps:["Electronegativity increases up and to the right in the periodic table","Fluorine is the most electronegative element (3.98)","F > O(3.44) > N(3.04) > Cl(3.16) ‚Üí Answer: C"]},
    {q:"Units of first-order rate constant:",opts:["mol¬∑L‚Åª¬π¬∑s‚Åª¬π","L¬∑mol‚Åª¬π¬∑s‚Åª¬π","s‚Åª¬π","mol¬∑L‚Åª¬π"],ans:2,
     expl:"For first-order: rate = k[A]. So k = rate/[A] = (mol¬∑L‚Åª¬π¬∑s‚Åª¬π)/(mol¬∑L‚Åª¬π) = s‚Åª¬π.",
     steps:["Rate law: rate = k[A]¬π","Rearrange: k = rate / [A]","Units: (mol L‚Åª¬π s‚Åª¬π) / (mol L‚Åª¬π) = s‚Åª¬π ‚Üí Answer: C"]},
    {q:"Oxidation number of Mn in KMnO‚ÇÑ:",opts:["+5","+6","+7","+4"],ans:2,
     expl:"K=+1, O=‚àí2. Equation: +1 + x + 4(‚àí2) = 0 ‚Üí x = +7.",
     steps:["Assign K=+1, O=‚àí2","Write equation: 1 + x + 4(‚àí2) = 0","Solve: x = 8 ‚àí 1 = +7 ‚Üí Answer: C"]},
    {q:"Avogadro's law: equal volumes at same T, P contain:",opts:["Same mass","Same no. of molecules","Same no. of atoms","Same density"],ans:1,
     expl:"Avogadro's law: V ‚àù n at constant T and P. Equal volumes ‚Üí equal moles ‚Üí equal number of molecules.",
     steps:["Avogadro: V/n = constant at same T, P","Equal volumes ‚Üí equal moles (n)","n‚ÇÅ = n‚ÇÇ ‚Üí equal molecules (N = nN‚Çê) ‚Üí Answer: B"]},
    {q:"IUPAC name of CH‚ÇÉ-CH(OH)-CH‚ÇÉ:",opts:["1-propanol","2-propanol","Propanal","Propanone"],ans:1,
     expl:"Longest chain = 3 carbons (propane). OH on carbon 2 ‚Üí propan-2-ol = 2-propanol.",
     steps:["Identify longest chain containing OH: 3 carbons ‚Üí propane","Number from end giving OH the lowest locant: position 2","Name: propan-2-ol ‚Üí Answer: B"]},
    {q:"Esterification is a reaction between:",opts:["Acid + Base","Carboxylic acid + Alcohol","Alcohol + Base","Aldehyde + Alcohol"],ans:1,
     expl:"RCOOH + R'OH ‚áå RCOOR' + H‚ÇÇO. This acid-catalysed condensation is esterification.",
     steps:["Esterification forms esters","Requires ‚àíCOOH (carboxylic acid) + ‚àíOH (alcohol)","Product: ester + water (H‚ÇÇSO‚ÇÑ catalyst) ‚Üí Answer: B"]},
    {q:"Which is a lyophilic colloid?",opts:["Gold sol","Starch sol","Arsenic sulphide sol","Ferric hydroxide sol"],ans:1,
     expl:"Starch sol is lyophilic (solvent-loving): large interaction with solvent, stable, reversible. The others are lyophobic.",
     steps:["Lyophilic = strong affinity for solvent ‚Üí stable","Starch, gelatin, albumin are lyophilic colloids","Gold sol, AS‚ÇÇS‚ÇÉ, Fe(OH)‚ÇÉ are lyophobic ‚Üí Answer: B"]}
  ]
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
// Chapter quiz
let cSubj=null, cTab=11, cChName='', cChIdx=0, cLevel='basic';
let cQs=[], cQi=0, cScore=0, cCor=0, cWrg=0, cSkp=0, cAnswers=[];

// PYQ
let pyqYear=null, pyqSF='all';
let pQs=[], pQi=0, pScore=0, pCor=0, pWrg=0, pAnswers=[];
let pTimerInt=null, pSecsLeft=0;

// Shared
let autoTimer=null, exitCtx='ch';

// User
const userId = localStorage.getItem('ss_uid') || (()=>{const id='u_'+Math.random().toString(36).substr(2,12);localStorage.setItem('ss_uid',id);return id;})();
let username = localStorage.getItem('ss_uname') || '';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('load',()=>{
  const h=new Date().getHours();
  document.getElementById('greeting').textContent=h<12?'Good Morning! üëã':h<17?'Good Afternoon! üëã':'Good Evening! üëã';
  updateUBtn();
  setTimeout(()=>{
    const sp=document.getElementById('splash');
    sp.classList.add('out');
    setTimeout(()=>{sp.remove();document.getElementById('app').classList.add('vis');if(!username)setTimeout(openUserModal,800);},400);
  },2900);
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   USER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateUBtn(){document.getElementById('user-btn').textContent=username?`üë§ ${username}`:'üë§ Set Name';}
function openUserModal(){document.getElementById('uname-input').value=username||'';document.getElementById('user-modal').classList.remove('hide');}
function closeUserModal(){document.getElementById('user-modal').classList.add('hide');}
function saveUsername(){
  const v=document.getElementById('uname-input').value.trim();
  if(!v){showToast('Please enter a name','err');return;}
  username=v;localStorage.setItem('ss_uname',username);updateUBtn();closeUserModal();showToast('‚úÖ Name saved!','ok');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showScr(id){document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));document.getElementById('scr-'+id).classList.add('on');}
function goHome(){clearAA();showScr('home');}
function goTopics(){clearAA();showScr('topics');}

function openSubject(sub){
  cSubj=sub;
  document.getElementById('t-subj-name').textContent=sub.charAt(0).toUpperCase()+sub.slice(1);
  document.getElementById('t-icon').textContent=DATA[sub].icon;
  cTab=11;
  document.getElementById('tab-11').classList.add('on');
  document.getElementById('tab-12').classList.remove('on');
  renderChapters();showScr('topics');
}

function switchTab(cls){
  cTab=cls;
  document.getElementById('tab-11').classList.toggle('on',cls===11);
  document.getElementById('tab-12').classList.toggle('on',cls===12);
  renderChapters();
}

function renderChapters(){
  const chs=DATA[cSubj].chapters[cTab];
  const col={physics:'#1A3E8C',biology:'#1A6B3C',chemistry:'#7A2A0A'}[cSubj];
  document.getElementById('ch-list').innerHTML=chs.map((ch,i)=>`
    <div class="ch-card" style="border-left-color:${col}">
      <div class="ch-num" style="background:linear-gradient(135deg,${col}dd,${col}99)">${i+1}</div>
      <div class="ch-info">
        <div class="ch-nm">${ch.n}</div>
        <div class="ch-sub">${ch.qs} questions ¬∑ Basic / Intermediate / Advanced</div>
        <div class="pb"><div class="pb-fill" style="width:0%"></div></div>
      </div>
      <button class="go-btn" onclick="openLvModal(${i},'${ch.n.replace(/'/g,"\\'")}')">Start ‚Üó</button>
    </div>`).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LEVEL MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openLvModal(idx,name){
  cChIdx=idx; cChName=name;
  document.getElementById('lv-modal-sub').textContent=`${name} ¬∑ ${cSubj.charAt(0).toUpperCase()+cSubj.slice(1)}`;
  document.getElementById('lv-modal').classList.remove('hide');
}
function closeLvModal(){document.getElementById('lv-modal').classList.add('hide');}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHAPTER QUIZ
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function startQuiz(level){
  closeLvModal(); cLevel=level;
  document.getElementById('load-tx').textContent=`Loading ${level} questions‚Ä¶`;
  document.getElementById('load-sub').textContent=cChName;
  showScr('loading');

  let qs=await fetchChapterQs(cSubj,cChName,level);
  if(!qs||qs.length===0){
    qs=shuffle([...FB[cSubj]]).slice(0,8).map(q=>({...q,level}));
    showToast('üí° Sample Qs loaded ‚Äî add yours to Supabase!','ok');
  }

  cQs=qs; cQi=0; cScore=0; cCor=0; cWrg=0; cSkp=0;
  cAnswers=new Array(qs.length).fill(null);

  document.getElementById('q-title').textContent=cChName;
  const pill=document.getElementById('lv-pill');
  pill.textContent=level.charAt(0).toUpperCase()+level.slice(1);
  pill.className='lv-pill '+{basic:'pl-bas',intermediate:'pl-int',advanced:'pl-adv'}[level];
  document.getElementById('sc-pill').textContent='Score: 0';
  renderChQ(); showScr('quiz');
}

async function fetchChapterQs(subject,chapter,level){
  try{
    const enc=encodeURIComponent(chapter);
    const data=await sbGet('questions',`?subject=eq.${subject}&chapter=eq.${enc}&level=eq.${level}&select=id,q,opts,ans,expl,steps&limit=20`);
    return shuffle(data).slice(0,Math.min(10,data.length));
  }catch(e){console.warn('DB:',e.message);return null;}
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function renderChQ(){
  clearAA();
  const q=cQs[cQi], L=['A','B','C','D'];
  const pct=(cQi/cQs.length)*100;
  document.getElementById('q-prog').style.width=pct+'%';
  document.getElementById('q-ctr').textContent=`Q ${cQi+1} / ${cQs.length}`;
  const canGoBack=cQi>0 && cAnswers[cQi-1]===null;
  document.getElementById('q-content').innerHTML=`
    <div class="qcard">
      <div class="qnum">QUESTION ${cQi+1}</div>
      <div class="qtext">${q.q}</div>
    </div>
    <div class="opts" id="opts">
      ${q.opts.map((o,i)=>`<button class="opt" id="o${i}" onclick="pickCh(${i})"><div class="ol">${L[i]}</div><div class="ot">${o}</div></button>`).join('')}
    </div>
    ${canGoBack?`<button class="prev-btn" onclick="prevCh()">‚Üê Previous Question</button>`:''}
    <div id="fb"></div>`;
}

function prevCh(){
  if(cQi>0 && cAnswers[cQi-1]===null){cQi--;renderChQ();}
}

function pickCh(sel){
  const q=cQs[cQi], L=['A','B','C','D'];
  cAnswers[cQi]=sel;
  document.querySelectorAll('.opt').forEach(b=>b.disabled=true);
  const ok=sel===q.ans;
  document.getElementById('o'+sel).classList.add(ok?'cor':'wrg');
  document.getElementById('o'+sel).querySelector('.ol').textContent=ok?'‚úì':'‚úó';
  if(!ok){document.getElementById('o'+q.ans).classList.add('rev');document.getElementById('o'+q.ans).querySelector('.ol').textContent='‚úì';}
  if(ok){cScore+=4;cCor++;}else{cScore-=1;cWrg++;}
  document.getElementById('sc-pill').textContent=`Score: ${cScore}`;
  const pill=document.getElementById('sc-pill');
  pill.classList.remove('pop','shk');void pill.offsetWidth;pill.classList.add(ok?'pop':'shk');
  document.getElementById('fb').innerHTML=`
    <div class="fb ${ok?'cor':'wrg'}">${ok?'‚úÖ Correct! +4 pts':`‚ùå Wrong ‚àí1 ¬∑ Correct: (${L[q.ans]}) ${q.opts[q.ans]}`}</div>
    <div class="expl-box">
      <div class="expl-lbl">üìò Explanation</div>
      <div class="expl-tx">${q.expl}</div>
      ${buildSteps(q.steps,false)}
    </div>
    ${cQi===cQs.length-1
      ? `<button class="submit-btn" onclick="showChResults()">‚úÖ Submit Quiz ‚Üí</button>`
      : buildAA('nextCh()')}`;
  if(cQi<cQs.length-1) startAA(()=>nextCh());
  refreshPaletteIfOpen();
}

function nextCh(){
  if(cQi<cQs.length-1){cQi++;renderChQ();}else showChResults();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHAPTER RESULTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function showChResults(){
  clearAA();
  cSkp=cAnswers.filter(a=>a===null).length;
  const ns=(cCor*4)-(cWrg*1), max=cQs.length*4, pct=Math.round((cCor/cQs.length)*100);
  fillResults(cCor,cWrg,cSkp,cQs.length,ns,max,pct,'Quiz Complete! üéâ');
  document.getElementById('r-btns').innerHTML=`
    <button class="rbtn rb-p" onclick="startQuiz(cLevel)">üîÑ Retry Chapter</button>
    <button class="rbtn rb-s" onclick="openReview(cQs,cAnswers,false)">üìñ Step-by-Step Review</button>
    <button class="rbtn rb-s" onclick="goTopics()">üìö Choose Another Chapter</button>
    <button class="rbtn rb-s" onclick="openLeaderboard()">üèÜ Leaderboard</button>`;
  showScr('results');
  document.getElementById('save-st').textContent='üíæ Saving to Supabase‚Ä¶';
  try{
    await sbPost('progress',{user_id:userId,subject:cSubj,chapter:cChName,level:cLevel,correct:cCor,wrong:cWrg,skipped:cSkp,neet_score:ns});
    await updateLB(ns,cCor);
    document.getElementById('save-st').textContent='‚úÖ Saved!';
  }catch(e){document.getElementById('save-st').textContent='‚ö†Ô∏è Not saved (offline?)';}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PYQ SECTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openPYQ(){
  pyqYear=null;
  document.querySelectorAll('.yr-btn').forEach(b=>b.classList.remove('sel'));
  document.getElementById('pyq-go').disabled=true;
  document.getElementById('pyq-go').textContent='üìú Start Attempt ‚Üí';
  showScr('pyq');
}

function selectYear(y){
  // Only 2025 has data in Supabase currently
  const available=[2025];
  if(!available.includes(y)){showToast('Coming soon ‚Äî only 2025 is available now','err');return;}
  pyqYear=y;
  document.querySelectorAll('.yr-btn').forEach(b=>b.classList.remove('sel'));
  document.getElementById('yr-'+y).classList.add('sel');
  document.getElementById('pyq-go').disabled=false;
}

async function startPYQ(){
  if(!pyqYear)return;
  const btn=document.getElementById('pyq-go');
  btn.disabled=true; btn.textContent='Loading‚Ä¶';
  document.getElementById('load-tx').textContent=`Loading NEET ${pyqYear} PYQs‚Ä¶`;
  document.getElementById('load-sub').textContent='üß¨ Biology ¬∑ 90 Questions';
  showScr('loading');

  let qs=await fetchPYQs(pyqYear,pyqSF);
  if(!qs||qs.length===0){
    qs=shuffle([...FB.biology]).map(q=>({...q,subject:'biology',pyq_year:pyqYear,chapter:''}));
    showToast('üí° Sample questions shown ‚Äî upload real PYQs to Supabase!','ok');
  }

  pQs=qs; pQi=0; pScore=0; pCor=0; pWrg=0;
  pAnswers=new Array(qs.length).fill(null);
  pSecsLeft=qs.length*120; // 2 min per question

  document.getElementById('pyq-title').textContent=`NEET ${pyqYear}`;
  document.getElementById('pyq-sc').textContent='0';
  updatePYQTimer();
  pTimerInt=setInterval(tickPYQ,1000);
  renderPYQQ(); showScr('pyq-quiz');
  btn.disabled=false; btn.textContent='üìú Start Attempt ‚Üí';
}

async function fetchPYQs(year,sub){
  try{
    // pyq_questions table columns: id, q, opts, ans, expl, steps, created_at
    // opts and steps are text[] ‚Äî PostgREST returns them as JSON arrays
    const data=await sbGet('pyq_questions','?select=id,q,opts,ans,expl,steps&order=id&limit=200');
    if(!data||data.length===0)return null;
    // Normalise: ensure opts and steps are always JS arrays
    const normalised=data.map(row=>({
      ...row,
      opts:  Array.isArray(row.opts)  ? row.opts  : (typeof row.opts==='string'  ? JSON.parse(row.opts)  : []),
      steps: Array.isArray(row.steps) ? row.steps : (typeof row.steps==='string' ? JSON.parse(row.steps) : []),
      ans:   Number(row.ans),
      subject:'biology',
      chapter:'',
      pyq_year:year
    }));
    return shuffle(normalised);
  }catch(e){console.warn('PYQ DB fetch error:',e.message);return null;}
}

/* ‚îÄ‚îÄ PYQ Timer ‚îÄ‚îÄ */
function tickPYQ(){
  pSecsLeft--;
  updatePYQTimer();
  if(pSecsLeft<=0){clearInterval(pTimerInt);showToast('‚è∞ Time up!','err');showPYQResults();}
}
function updatePYQTimer(){
  const el=document.getElementById('pyq-timer');
  if(!el)return;
  const m=Math.floor(pSecsLeft/60), s=pSecsLeft%60;
  el.textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  el.className='timer';
  if(pSecsLeft<=60)el.classList.add('dng');
  else if(pSecsLeft<=300)el.classList.add('warn');
}
function stopPYQ(){clearInterval(pTimerInt);pTimerInt=null;}

/* ‚îÄ‚îÄ PYQ render ‚îÄ‚îÄ */
function renderPYQQ(){
  clearAA();
  const q=pQs[pQi], L=['A','B','C','D'];
  const isLast=pQi===pQs.length-1;
  const pct=(pQi/pQs.length)*100;
  document.getElementById('pyq-prog').style.width=pct+'%';
  document.getElementById('pyq-ctr').textContent=`Q ${pQi+1} / ${pQs.length}`;
  // Hide timer on last question
  const timerEl=document.getElementById('pyq-timer');
  if(timerEl) timerEl.style.display=isLast?'none':'';

  const stMap={physics:'st-phy',biology:'st-bio',chemistry:'st-che'};
  const siMap={physics:'‚öõÔ∏è Physics',biology:'üß¨ Biology',chemistry:'üß™ Chemistry'};
  const subKey=q.subject||'biology';
  const stEl=document.getElementById('pyq-sub-tag');
  stEl.className='sub-tag '+(stMap[subKey]||'st-bio');
  stEl.textContent=siMap[subKey]||'üß¨ Biology';

  const canGoBackPYQ=pQi>0 && pAnswers[pQi-1]===null;
  document.getElementById('pyq-content').innerHTML=`
    <div class="qcard pyq">
      <div class="qnum tl">NEET ${q.pyq_year||pyqYear} ¬∑ Q${pQi+1}
        ${q.chapter?`<span class="qtag">${q.chapter}</span>`:''}
      </div>
      <div class="qtext">${q.q}</div>
    </div>
    <div class="opts" id="pyq-opts">
      ${q.opts.map((o,i)=>`<button class="opt" id="po${i}" onclick="pickPYQ(${i})"><div class="ol">${L[i]}</div><div class="ot">${o}</div></button>`).join('')}
    </div>
    ${isLast ? `
    <div style="display:flex;gap:10px;">
      ${canGoBackPYQ?`<button class="prev-btn" style="flex:1" onclick="prevPYQ()">‚Üê Previous</button>`:''}
      <button class="submit-btn" id="skip-btn" style="${canGoBackPYQ?'flex:2':''}" onclick="submitPYQ()">üèÅ Submit &amp; See Results ‚Üí</button>
    </div>` : `
    <div style="display:flex;gap:10px;">
      ${canGoBackPYQ?`<button class="prev-btn" style="flex:1" onclick="prevPYQ()">‚Üê Previous</button>`:''}
      <button class="skip-btn" id="skip-btn" style="${canGoBackPYQ?'flex:2':''}" onclick="skipPYQ()">‚è≠ Skip (no penalty)</button>
    </div>`}
    <div id="pyq-fb"></div>`;
}

function prevPYQ(){
  if(pQi>0 && pAnswers[pQi-1]===null){pQi--;renderPYQQ();}
}

function pickPYQ(sel){
  const q=pQs[pQi], L=['A','B','C','D'];
  pAnswers[pQi]=sel;
  document.querySelectorAll('#pyq-opts .opt').forEach(b=>b.disabled=true);
  const sb=document.getElementById('skip-btn');if(sb)sb.style.display='none';
  const ok=sel===q.ans;
  document.getElementById('po'+sel).classList.add(ok?'cor':'wrg');
  document.getElementById('po'+sel).querySelector('.ol').textContent=ok?'‚úì':'‚úó';
  if(!ok){document.getElementById('po'+q.ans).classList.add('rev');document.getElementById('po'+q.ans).querySelector('.ol').textContent='‚úì';}
  if(ok){pScore+=4;pCor++;}else{pScore-=1;pWrg++;}
  document.getElementById('pyq-sc').textContent=pScore;
  document.getElementById('pyq-fb').innerHTML=`
    <div class="fb ${ok?'cor':'wrg'}">${ok?'‚úÖ Correct! +4 pts':`‚ùå Wrong ‚àí1 ¬∑ Correct: (${L[q.ans]}) ${q.opts[q.ans]}`}</div>
    <div class="expl-box tl">
      <div class="expl-lbl tl">üìò Step-by-Step Solution</div>
      <div class="expl-tx">${q.expl}</div>
      ${buildSteps(q.steps,true)}
    </div>
    ${pQi===pQs.length-1
      ? `<button class="submit-btn" onclick="showPYQResults()">üèÅ Submit &amp; See Results ‚Üí</button>`
      : buildAA('nextPYQ()')}`;
  if(pQi<pQs.length-1) startAA(()=>nextPYQ());
  refreshPaletteIfOpen();
}

function skipPYQ(){
  pAnswers[pQi]=null;
  const sb=document.getElementById('skip-btn');if(sb)sb.style.display='none';
  document.getElementById('pyq-fb').innerHTML=`
    <div class="fb skp">‚è≠ Skipped ‚Äî no penalty</div>
    ${pQi===pQs.length-1
      ? `<button class="submit-btn" onclick="showPYQResults()">üèÅ Submit &amp; See Results ‚Üí</button>`
      : buildAA('nextPYQ()',2000)}`;
  if(pQi<pQs.length-1) startAA(()=>nextPYQ(),2000);
  refreshPaletteIfOpen();
}


function submitPYQ(){
  // If user hits Submit without answering the last question, count it as skipped
  // pAnswers[pQi] is already null (skipped) or set (answered) ‚Äî just go to results
  stopPYQ(); showPYQResults();
}
function nextPYQ(){
  if(pQi<pQs.length-1){pQi++;renderPYQQ();}else{stopPYQ();showPYQResults();}
}

/* ‚îÄ‚îÄ PYQ Results ‚îÄ‚îÄ */
async function showPYQResults(){
  stopPYQ(); clearAA();
  const skp=pAnswers.filter(a=>a===null).length;
  const max=pQs.length*4, pct=Math.round((pCor/pQs.length)*100);
  fillResults(pCor,pWrg,skp,pQs.length,pScore,max,pct,`NEET ${pyqYear} Complete! üìú`);
  document.getElementById('r-btns').innerHTML=`
    <button class="rbtn rb-p" onclick="openPYQ()">üìú Try Another Year</button>
    <button class="rbtn rb-s" onclick="openReview(pQs,pAnswers,true)">üìñ Step-by-Step Review</button>
    <button class="rbtn rb-s" onclick="goHome()">üè† Home</button>
    <button class="rbtn rb-s" onclick="openLeaderboard()">üèÜ Leaderboard</button>`;
  showScr('results');
  document.getElementById('save-st').textContent='üíæ Saving PYQ result‚Ä¶';
  try{
    await sbPost('progress',{user_id:userId,subject:'pyq',chapter:`NEET ${pyqYear}`,level:'pyq',correct:pCor,wrong:pWrg,skipped:skp,neet_score:pScore});
    await updateLB(pScore,pCor);
    document.getElementById('save-st').textContent='‚úÖ Saved!';
  }catch(e){document.getElementById('save-st').textContent='‚ö†Ô∏è Not saved (offline?)';}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SHARED RESULTS HELPER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function fillResults(cor,wrg,skp,tot,ns,max,pct,title){
  document.getElementById('res-title').textContent=title;
  document.getElementById('r-cor').textContent=cor;
  document.getElementById('r-wrg').textContent=wrg;
  document.getElementById('r-skp').textContent=skp;
  document.getElementById('r-tot').textContent=tot;
  document.getElementById('r-neet').textContent=ns;
  document.getElementById('r-max').textContent=`/ ${max} maximum`;
  const b=document.getElementById('perf'); b.className='perf';
  if(pct>=80){b.classList.add('p-exc');b.textContent='üèÜ Excellent!';}
  else if(pct>=50){b.classList.add('p-gd');b.textContent='üëç Good Job!';}
  else{b.classList.add('p-pr');b.textContent='üìö Keep Practising';}
  let cur=0; const el=document.getElementById('sc-display');
  const step=Math.ceil(Math.abs(ns)/40)||1;
  const iv=setInterval(()=>{if(Math.abs(cur-ns)<=step){cur=ns;clearInterval(iv);}else cur+=(ns>0?step:-step);el.textContent=cur;},28);
  setTimeout(()=>{document.getElementById('score-arc').style.strokeDashoffset=502*(1-Math.max(pct,0)/100);},100);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QUESTION PALETTE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let palMode=null; // 'ch' or 'pyq'

function openPalette(mode){
  palMode=mode;
  const qs   = mode==='ch'  ? cQs      : pQs;
  const ans  = mode==='ch'  ? cAnswers : pAnswers;
  const qi   = mode==='ch'  ? cQi      : pQi;
  document.getElementById('pal-title').textContent=
    mode==='ch' ? `Questions ¬∑ ${qs.length} total` : `NEET ${pyqYear} ¬∑ ${qs.length} Qs`;
  renderPaletteGrid(qs, ans, qi);
  document.getElementById('pal-overlay').classList.add('on');
  document.getElementById('pal-sheet').classList.add('on');
}

function closePalette(){
  document.getElementById('pal-overlay').classList.remove('on');
  document.getElementById('pal-sheet').classList.remove('on');
}

function renderPaletteGrid(qs, ans, qi){
  const grid = document.getElementById('pal-grid');
  grid.innerHTML = qs.map((q,i)=>{
    let cls='pb-unans';
    if(i===qi)            cls='pb-cur';
    else if(ans[i]===null && i<qi) cls='pb-skp';  // visited & skipped
    else if(ans[i]!==null && ans[i]===q.ans) cls='pb-cor';
    else if(ans[i]!==null && ans[i]!==q.ans) cls='pb-wrg';
    // unanswered & not yet visited stays pb-unans
    return `<button class="pbub ${cls}" onclick="jumpToQ(${i})" title="Q${i+1}">${i+1}</button>`;
  }).join('');
}

function jumpToQ(i){
  closePalette();
  if(palMode==='ch'){
    const ans=cAnswers[i];
    cQi=i;
    if(ans===null){
      // Unanswered or skipped ‚Äî render fresh so user can answer
      renderChQ();
    } else {
      // Already answered ‚Äî show read-only view with explanation
      renderChQAnswered(i);
    }
  } else {
    const ans=pAnswers[i];
    pQi=i;
    if(ans===null){
      renderPYQQ();
    } else {
      renderPYQQAnswered(i);
    }
  }
}

function renderChQAnswered(i){
  clearAA();
  const q=cQs[i], L=['A','B','C','D'], ans=cAnswers[i];
  const pct=(i/cQs.length)*100;
  document.getElementById('q-prog').style.width=pct+'%';
  document.getElementById('q-ctr').textContent=`Q ${i+1} / ${cQs.length}`;
  document.getElementById('q-content').innerHTML=`
    <div class="qcard">
      <div class="qnum">QUESTION ${i+1} <span style="font-size:.7rem;opacity:.6">(answered)</span></div>
      <div class="qtext">${q.q}</div>
    </div>
    <div class="opts">
      ${q.opts.map((o,oi)=>{
        let cls=''; let lbl=L[oi];
        if(oi===ans && ans===q.ans){cls='cor';lbl='‚úì';}
        else if(oi===ans && ans!==q.ans){cls='wrg';lbl='‚úó';}
        else if(oi===q.ans && ans!==q.ans){cls='rev';lbl='‚úì';}
        return `<button class="opt ${cls}" disabled><div class="ol">${lbl}</div><div class="ot">${o}</div></button>`;
      }).join('')}
    </div>
    <div class="expl-box" style="margin-top:4px;">
      <div class="expl-lbl">üìò Explanation</div>
      <div class="expl-tx">${q.expl}</div>
      ${buildSteps(q.steps,false)}
    </div>
    ${i===cQs.length-1
      ? `<button class="submit-btn" style="margin-top:8px;" onclick="showChResults()">‚úÖ Submit Quiz ‚Üí</button>`
      : `<button class="next-btn" style="margin-top:8px;" onclick="continueFromAnswered('ch',${i})">Continue ‚Üí</button>`}`;
}

function renderPYQQAnswered(i){
  clearAA();
  const q=pQs[i], L=['A','B','C','D'], ans=pAnswers[i];
  const pct=(i/pQs.length)*100;
  document.getElementById('pyq-prog').style.width=pct+'%';
  document.getElementById('pyq-ctr').textContent=`Q ${i+1} / ${pQs.length}`;
  document.getElementById('pyq-content').innerHTML=`
    <div class="qcard pyq">
      <div class="qnum tl">NEET ${q.pyq_year||pyqYear} ¬∑ Q${i+1} <span style="font-size:.7rem;opacity:.6">(answered)</span></div>
      <div class="qtext">${q.q}</div>
    </div>
    <div class="opts">
      ${q.opts.map((o,oi)=>{
        let cls=''; let lbl=L[oi];
        if(oi===ans && ans===q.ans){cls='cor';lbl='‚úì';}
        else if(oi===ans && ans!==q.ans){cls='wrg';lbl='‚úó';}
        else if(oi===q.ans && ans!==q.ans){cls='rev';lbl='‚úì';}
        return `<button class="opt ${cls}" disabled><div class="ol">${lbl}</div><div class="ot">${o}</div></button>`;
      }).join('')}
    </div>
    <div class="expl-box tl" style="margin-top:4px;">
      <div class="expl-lbl tl">üìò Step-by-Step Solution</div>
      <div class="expl-tx">${q.expl}</div>
      ${buildSteps(q.steps,true)}
    </div>
    ${i===pQs.length-1
      ? `<button class="submit-btn" style="margin-top:8px;" onclick="showPYQResults()">üèÅ Submit &amp; See Results ‚Üí</button>`
      : `<button class="next-btn" style="margin-top:8px;" onclick="continueFromAnswered('pyq',${i})">Continue ‚Üí</button>`}`;
}

function continueFromAnswered(mode,fromIdx){
  // Find the next unanswered question after fromIdx, else go to results
  if(mode==='ch'){
    const next=cAnswers.findIndex((a,i)=>i>fromIdx && a===null);
    if(next!==-1){cQi=next;renderChQ();}
    else{
      const anyLeft=cAnswers.findIndex((a,i)=>a===null && i<=fromIdx);
      if(anyLeft!==-1){cQi=anyLeft;renderChQ();}
      else showChResults();
    }
  } else {
    const next=pAnswers.findIndex((a,i)=>i>fromIdx && a===null);
    if(next!==-1){pQi=next;renderPYQQ();}
    else{
      const anyLeft=pAnswers.findIndex((a,i)=>a===null && i<=fromIdx);
      if(anyLeft!==-1){pQi=anyLeft;renderPYQQ();}
      else{stopPYQ();showPYQResults();}
    }
  }
}

/* update palette live whenever an answer is recorded */
function refreshPaletteIfOpen(){
  const sheet=document.getElementById('pal-sheet');
  if(!sheet.classList.contains('on'))return;
  const qs  = palMode==='ch' ? cQs      : pQs;
  const ans = palMode==='ch' ? cAnswers : pAnswers;
  const qi  = palMode==='ch' ? cQi      : pQi;
  renderPaletteGrid(qs,ans,qi);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LEADERBOARD UPDATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function updateLB(ns,cor){
  if(!username)return;
  try{
    const ex=await sbGet('leaderboard',`?user_id=eq.${userId}&limit=1`);
    if(ex&&ex.length>0){
      const row=ex[0];
      await sbPatch('leaderboard',`?id=eq.${row.id}`,{username,total_score:row.total_score+ns,total_correct:row.total_correct+cor,total_attempts:row.total_attempts+1,updated_at:new Date().toISOString()});
    }else{
      await sbPost('leaderboard',{user_id:userId,username,total_score:ns,total_correct:cor,total_attempts:1});
    }
  }catch(e){console.warn('LB:',e.message);}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REVIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openReview(qs,answers,isPYQ){
  const L=['A','B','C','D'];
  document.getElementById('rev-list').innerHTML=qs.map((q,i)=>{
    const ua=answers[i], ok=ua===q.ans, sk=ua===null;
    const cls=sk?'s':ok?'c':'w', bt=sk?'‚è≠ Skipped':ok?'‚úÖ Correct':'‚ùå Wrong';
    const opts=q.opts.map((o,oi)=>`<div class="rco ${oi===q.ans?'ic':oi===ua&&!ok?'iw':''}"><b>(${L[oi]})</b><span>${o}</span></div>`).join('');
    const stepsHtml=q.steps&&q.steps.length?`<div class="rc-steps">${q.steps.map((s,si)=>`<div class="rc-step"><div class="rc-sn">${si+1}</div><div>${s}</div></div>`).join('')}</div>`:'';
    const pyqTag=isPYQ?`<div class="pyq-tag">NEET ${q.pyq_year||pyqYear} ¬∑ ${(q.subject||'').charAt(0).toUpperCase()+(q.subject||'').slice(1)}</div>`:'';
    return `<div class="rcard ${cls}">
      <div class="rc-hdr"><span class="rc-qn">Q${i+1}${q.chapter?' ¬∑ '+q.chapter:''}</span><span class="rc-bdg ${cls}">${bt}</span></div>
      ${pyqTag}
      <div class="rc-q">${q.q}</div>
      <div class="rc-opts">${opts}</div>
      <div class="rc-expl"><span class="rc-el">üìò Explanation</span>${q.expl}${stepsHtml}</div>
    </div>`;
  }).join('');
  showScr('review');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTO-ADVANCE (5 s)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildAA(fnStr,ms=5000){
  return `<div class="aa-wrap">
    <button class="next-btn" onclick="clearAA();${fnStr}">Next Question ‚Üí (skip wait)</button>
    <div class="aa-bar"><div class="aa-fill" id="aa-fill" style="width:100%"></div></div>
    <div class="aa-lbl" id="aa-lbl">Auto-advancing in 5s‚Ä¶</div>
  </div>`;
}

function startAA(cb,ms=5000){
  clearAA();
  const start=Date.now();
  autoTimer=setInterval(()=>{
    const elapsed=Date.now()-start;
    const pct=Math.max(0,100-elapsed/ms*100);
    const fill=document.getElementById('aa-fill');
    const lbl=document.getElementById('aa-lbl');
    if(fill)fill.style.width=pct+'%';
    if(lbl)lbl.textContent=`Auto-advancing in ${Math.max(0,Math.ceil((ms-elapsed)/1000))}s‚Ä¶`;
    if(elapsed>=ms){clearAA();try{cb();}catch(e){}}
  },100);
}

function clearAA(){if(autoTimer){clearInterval(autoTimer);autoTimer=null;}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STEPS HELPER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildSteps(steps,isTeal){
  if(!steps||!steps.length)return '';
  const nc=isTeal?'tl':'';
  return `<div class="steps">${steps.map((s,i)=>`<div class="step-row"><div class="step-n ${nc}">${i+1}</div><div class="step-t">${s}</div></div>`).join('')}</div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LEADERBOARD SCREEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function openLeaderboard(){showScr('lb');loadLB();}
async function loadLB(){
  document.getElementById('lb-body').innerHTML=`<div class="empty"><div class="eico" style="animation:spin 1s linear infinite;display:inline-block">‚ü≥</div><div class="etitle" style="margin-top:8px">Loading‚Ä¶</div></div>`;
  try{
    const data=await sbGet('leaderboard','?select=*&order=total_score.desc&limit=50');
    if(!data||data.length===0){document.getElementById('lb-body').innerHTML=`<div class="empty"><div class="eico">üèÜ</div><div class="etitle">No scores yet</div><div class="esub">Complete a quiz to appear here</div></div>`;return;}
    document.getElementById('lb-body').innerHTML=data.map((row,i)=>{
      const rk=i+1, isYou=row.user_id===userId;
      const rkCls=rk===1?'rk1':rk===2?'rk2':rk===3?'rk3':'rkn';
      const rkLbl=rk<=3?['ü•á','ü•à','ü•â'][rk-1]:rk;
      const sc=rk===1?'#C89B14':rk<=3?'var(--purple)':'var(--blue)';
      return `<div class="lbcard" ${isYou?'style="background:rgba(90,45,130,.05);border:2px solid rgba(90,45,130,.2);"':''}>
        <div class="lbrnk ${rkCls}">${rkLbl}</div>
        <div class="lb-info">
          <div class="lb-nm">${row.username||'Anonymous'}${isYou?'<span class="you-tag">You</span>':''}</div>
          <div class="lb-meta">${row.total_attempts} attempt${row.total_attempts!==1?'s':''} ¬∑ ${row.total_correct} correct</div>
        </div>
        <div class="lb-sc" style="color:${sc}">${row.total_score}</div>
      </div>`;
    }).join('');
  }catch(e){document.getElementById('lb-body').innerHTML=`<div class="empty"><div class="eico">‚ö†Ô∏è</div><div class="etitle">Could not load</div><div class="esub">${e.message}</div></div>`;}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ANALYTICS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function openAnalytics(){showScr('ana');loadAna();}
async function loadAna(){
  document.getElementById('ana-body').innerHTML=`<div class="empty"><div class="eico" style="animation:spin 1s linear infinite;display:inline-block">‚ü≥</div><div class="etitle" style="margin-top:8px">Loading‚Ä¶</div></div>`;
  try{
    const hist=await sbGet('progress',`?user_id=eq.${userId}&order=attempted_at.desc&limit=100`);
    if(!hist||hist.length===0){document.getElementById('ana-body').innerHTML=`<div class="empty"><div class="eico">üìä</div><div class="etitle">No history yet</div><div class="esub">Complete quizzes to see analytics</div></div>`;return;}
    const totC=hist.reduce((s,r)=>s+r.correct,0), totW=hist.reduce((s,r)=>s+r.wrong,0), totSc=hist.reduce((s,r)=>s+r.neet_score,0);
    const acc=totC+totW>0?Math.round(totC/(totC+totW)*100):0;
    const bySub={};hist.forEach(r=>{if(!bySub[r.subject])bySub[r.subject]={c:0,w:0};bySub[r.subject].c+=r.correct;bySub[r.subject].w+=r.wrong;});
    const byLvl={basic:0,intermediate:0,advanced:0,pyq:0};hist.forEach(r=>{if(byLvl[r.level]!==undefined)byLvl[r.level]++;});
    const scols={physics:'var(--blue)',biology:'var(--green-l)',chemistry:'var(--amber)',pyq:'var(--teal)'};
    const sicons={physics:'‚öõÔ∏è',biology:'üß¨',chemistry:'üß™',pyq:'üìú'};
    const bars=Object.entries(bySub).map(([sub,d])=>{
      const a=d.c+d.w>0?Math.round(d.c/(d.c+d.w)*100):0;
      return `<div class="bar-row"><div class="bar-lbl">${sicons[sub]||'üìö'} ${sub[0].toUpperCase()+sub.slice(1)}</div><div class="bar-wrap"><div class="bar-fill" style="width:${a}%;background:${scols[sub]||'var(--blue)'}"></div></div><div class="bar-pct">${a}%</div></div>`;
    }).join('');
    const recent=hist.slice(0,10).map(r=>{
      const ico=sicons[r.subject]||'üìö';
      const bg={physics:'rgba(26,62,140,.1)',biology:'rgba(46,155,90,.1)',chemistry:'rgba(192,80,32,.1)',pyq:'rgba(13,115,119,.1)'}[r.subject]||'#eee';
      const sc=r.neet_score>=0?'var(--green-l)':'#ff6b6b';
      const dt=new Date(r.attempted_at).toLocaleDateString('en-IN',{day:'numeric',month:'short'});
      return `<div class="hist-item"><div class="hist-ico" style="background:${bg}">${ico}</div><div class="hist-info"><div class="hist-nm">${r.chapter}</div><div class="hist-meta">${r.level} ¬∑ ${r.correct}‚úÖ ${r.wrong}‚ùå ¬∑ ${dt}</div></div><div class="hist-sc" style="color:${sc}">${r.neet_score>0?'+':''}${r.neet_score}</div></div>`;
    }).join('');
    document.getElementById('ana-body').innerHTML=`
      <div class="acard"><div class="atitle">Overall Stats</div><div class="agrid">
        <div class="astat"><div class="aval" style="color:var(--gold)">${totSc}</div><div class="albl">Total Score</div></div>
        <div class="astat"><div class="aval" style="color:var(--blue)">${hist.length}</div><div class="albl">Quizzes Done</div></div>
        <div class="astat"><div class="aval" style="color:var(--green-l)">${acc}%</div><div class="albl">Accuracy</div></div>
        <div class="astat"><div class="aval" style="color:var(--purple)">${totC}</div><div class="albl">Total Correct</div></div>
      </div></div>
      <div class="acard"><div class="atitle">Accuracy by Subject</div>${bars||'<div style="font-size:.85rem;color:var(--txm)">No data yet</div>'}</div>
      <div class="acard"><div class="atitle">Breakdown by Mode</div><div style="display:flex;gap:10px;flex-wrap:wrap;">
        <div class="astat" style="flex:1"><div class="aval" style="color:var(--green-l)">${byLvl.basic}</div><div class="albl">üü¢ Basic</div></div>
        <div class="astat" style="flex:1"><div class="aval" style="color:var(--gold)">${byLvl.intermediate}</div><div class="albl">üü° Inter</div></div>
        <div class="astat" style="flex:1"><div class="aval" style="color:#ff6b6b">${byLvl.advanced}</div><div class="albl">üî¥ Adv</div></div>
        <div class="astat" style="flex:1"><div class="aval" style="color:var(--teal)">${byLvl.pyq}</div><div class="albl">üìú PYQ</div></div>
      </div></div>
      <div class="acard"><div class="atitle">Recent Attempts</div>${recent}</div>`;
  }catch(e){document.getElementById('ana-body').innerHTML=`<div class="empty"><div class="eico">‚ö†Ô∏è</div><div class="etitle">Could not load</div><div class="esub">${e.message}</div></div>`;}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXIT DIALOG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function exitQuiz(ctx){exitCtx=ctx;document.getElementById('exit-dlg').classList.remove('hide');}
function closeDlg(){document.getElementById('exit-dlg').classList.add('hide');}
function confirmExit(){
  closeDlg(); clearAA();
  if(exitCtx==='pyq'){stopPYQ();showScr('pyq');}
  else goTopics();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showToast(msg,type='ok'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${type}`;
  void t.offsetWidth; t.classList.add('on');
  setTimeout(()=>t.classList.remove('on'),3000);
}
</script>

  <!-- QUESTION PALETTE (shared) -->
  <div class="pal-overlay" id="pal-overlay" onclick="closePalette()"></div>
  <div class="pal-sheet" id="pal-sheet">
    <div class="pal-drag"></div>
    <div class="pal-hdr">
      <div class="pal-title" id="pal-title">Questions</div>
      <button class="pal-close" onclick="closePalette()">‚úï</button>
    </div>
    <div class="pal-legend">
      <div class="pal-leg"><div class="pal-leg-dot ld-unans"></div>Unanswered</div>
      <div class="pal-leg"><div class="pal-leg-dot ld-cor"></div>Correct</div>
      <div class="pal-leg"><div class="pal-leg-dot ld-wrg"></div>Wrong</div>
      <div class="pal-leg"><div class="pal-leg-dot ld-skp"></div>Skipped</div>
      <div class="pal-leg"><div class="pal-leg-dot ld-cur"></div>Current</div>
    </div>
    <div class="pal-grid" id="pal-grid"></div>
  </div>

</body>
</html>
